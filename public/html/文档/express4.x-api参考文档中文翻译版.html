<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>express4.x中文版api参考文档</title>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            padding: 0;
            margin: 0;
        }
        .content{
            padding-left: 15em;
            background-color: rgba(232,227,228,1.00);
        }
    #menu{
        list-style-type: none;
        position:fixed;
        margin: 0;
        left: 2em;
        padding: 1em 0 0 1em;
        text-align:left;
        font-size:13px;
        overflow-y:auto;
         max-height: calc(100vh - 1em);
        max-width: 15em;
    }
        #menu ul{
            list-style-type: none;
            padding-left: 1em;
        }
        h1{
            font-size: 2em;
            padding-top: .5em;
            margin: 0;
        }
        table{
            border-collapse: collapse;
        }
        table td,
        table th{
            border:solid 1px rgba(88,88,88,1.00);
            border-collapse: collapse;
        }
    </style>
</head>
<body>
    <section class="content">
    <ul id="menu">
        <li id="express-api"><a href="#express" class="active">express()</a>
            <ul id="express-menu" class="active">
                <li><em>方法</em></li>
                <li id="express-json-middleware"><a href="#express.json" class="">express.json()</a></li>
                <li id="express-static-middleware"><a href="#express.static" class="">express.static()</a></li>
                <li id="express-router"><a href="#express.router" class="">express.Router()</a></li>
                <li id="express-urlencoded-middleware"><a href="#express.urlencoded" class="">express.urlencoded()</a>
                </li>
            </ul>
        </li>
        <li id="app-api"><a href="#app" class="">Application</a>
            <ul id="app-menu" class="">
                <li><em>属性</em>
                </li>
                <li><a href="#app.locals" class="">app.locals</a>
                </li>
                <li><a href="#app.mountpath" class="">app.mountpath</a>
                </li>
                <li><em>Events</em>
                </li>
                <li><a href="#app.onmount" class="">mount</a>
                </li>
                <li><em>方法</em>
                </li>
                <li><a href="#app.all" class="">app.all()</a>
                </li>
                <li><a href="#app.delete.method" class="">app.delete()</a>
                </li>
                <li><a href="#app.disable" class="">app.disable()</a>
                </li>
                <li><a href="#app.disabled" class="">app.disabled()</a>
                </li>
                <li><a href="#app.enable">app.enable()</a>
                </li>
                <li><a href="#app.enabled" class="">app.enabled()</a>
                </li>
                <li><a href="#app.engine" class="">app.engine()</a>
                </li>
                <li><a href="#app.get" class="">app.get()</a>
                </li>
                <li><a href="#app.get.method" class="">app.get()</a>
                </li>
                <li><a href="#app.listen" class="">app.listen()</a>
                </li>
                <li><a href="#app.METHOD" class="">app.METHOD()</a>
                </li>
                <li><a href="#app.param" class="">app.param()</a>
                </li>
                <li><a href="#app.path" class="">app.path()</a>
                </li>
                <li><a href="#app.post.method" class="">app.post()</a>
                </li>
                <li><a href="#app.put.method" class="">app.put()</a>
                </li>
                <li><a href="#app.render" class="">app.render()</a>
                </li>
                <li><a href="#app.route">app.route()</a>
                </li>
                <li><a href="#app.set" class="">app.set()</a>
                </li>
                <li><a href="#app.use" class="">app.use()</a>
                </li>
            </ul>
        </li>
        <li id="req-api"><a href="#req" class="">Request</a>
            <ul id="req-menu" class="">
                <li><em>属性</em>
                </li>
                <li><a href="#req.app" class="">req.app</a>
                </li>
                <li><a href="#req.baseUrl" class="">req.baseUrl</a>
                </li>
                <li><a href="#req.body" class="">req.body</a>
                </li>
                <li><a href="#req.cookies">req.cookies</a>
                </li>
                <li><a href="#req.fresh" class="">req.fresh</a>
                </li>
                <li><a href="#req.hostname">req.hostname</a>
                </li>
                <li><a href="#req.ip">req.ip</a>
                </li>
                <li><a href="#req.ips">req.ips</a>
                </li>
                <li><a href="#req.method">req.method</a>
                </li>
                <li><a href="#req.originalUrl" class="">req.originalUrl</a>
                </li>
                <li><a href="#req.params">req.params</a>
                </li>
                <li><a href="#req.path" class="">req.path</a>
                </li>
                <li><a href="#req.protocol" class="">req.protocol</a>
                </li>
                <li><a href="#req.query">req.query</a>
                </li>
                <li><a href="#req.route" class="">req.route</a>
                </li>
                <li><a href="#req.secure">req.secure</a>
                </li>
                <li><a href="#req.signedCookies" class="">req.signedCookies</a>
                </li>
                <li><a href="#req.stale">req.stale</a>
                </li>
                <li><a href="#req.subdomains" class="">req.subdomains</a>
                </li>
                <li><a href="#req.xhr">req.xhr</a>
                </li>
                <li><em>方法</em>
                </li>
                <li><a href="#req.accepts" class="">req.accepts()</a>
                </li>
                <li><a href="#req.acceptsCharsets" class="">req.acceptsCharsets()</a>
                </li>
                <li><a href="#req.acceptsEncodings">req.acceptsEncodings()</a>
                </li>
                <li><a href="#req.acceptsLanguages">req.acceptsLanguages()</a>
                </li>
                <li><a href="#req.get">req.get()</a>
                </li>
                <li><a href="#req.is" class="">req.is()</a>
                </li>
                <li><a href="#req.param" class="">req.param()</a>
                </li>
                <li><a href="#req.range" class="">req.range()</a>
                </li>
            </ul>
        </li>
        <li id="res-api"><a href="#res" class="">Response</a>
            <ul id="res-menu" class="">
                <li><em>属性</em>
                </li>
                <li><a href="#res.app">res.app </a>
                </li>
                <li><a href="#res.headersSent" class="">res.headersSent</a>
                </li>
                <li><a href="#res.locals" class="">res.locals</a>
                </li>
                <li><em>方法</em>
                </li>
                <li><a href="#res.append" class="">res.append()</a>
                </li>
                <li><a href="#res.attachment">res.attachment()</a>
                </li>
                <li><a href="#res.cookie" class="">res.cookie()</a>
                </li>
                <li><a href="#res.clearCookie">res.clearCookie()</a>
                </li>
                <li><a href="#res.download" class="">res.download()</a>
                </li>
                <li><a href="#res.end" class="">res.end()</a>
                </li>
                <li><a href="#res.format" class="">res.format()</a>
                </li>
                <li><a href="#res.get">res.get()</a>
                </li>
                <li><a href="#res.json" class="">res.json()</a>
                </li>
                <li><a href="#res.jsonp" class="">res.jsonp()</a>
                </li>
                <li><a href="#res.links" class="">res.links()</a>
                </li>
                <li><a href="#res.location" class="">res.location()</a>
                </li>
                <li><a href="#res.redirect" class="">res.redirect()</a>
                </li>
                <li><a href="#res.render" class="">res.render()</a>
                </li>
                <li><a href="#res.send" class="">res.send()</a>
                </li>
                <li><a href="#res.sendFile" class="">res.sendFile()</a>
                </li>
                <li><a href="#res.sendStatus" class="">res.sendStatus()</a>
                </li>
                <li><a href="#res.set" class="">res.set()</a>
                </li>
                <li><a href="#res.status" class="">res.status()</a>
                </li>
                <li><a href="#res.type" class="">res.type()</a>
                </li>
                <li><a href="#res.vary" class="">res.vary()</a>
                </li>
            </ul>
        </li>
        <li id="router-api"><a href="#router" class="">Router</a>
            <ul id="router-menu" class="">
                <li><em>方法</em>
                </li>
                <li><a href="#router.all" class="">router.all()</a>
                </li>
                <li><a href="#router.METHOD" class="">router.METHOD()</a>
                </li>
                <li><a href="#router.param" class="">router.param()</a>
                </li>
                <li><a href="#router.route" class="">router.route()</a>
                </li>
                <li><a href="#router.use" class="">router.use()</a>
                </li>
            </ul>
        </li>
    </ul>
    <div id="api-doc">

        <h1>

            4.x API

        </h1>

        <h2 id="express">

            express()

        </h2>

        <p>

            创建Express应用程序。
            该
            <code>express()</code>

            函数是
            <code>express</code>

            模块
            导出的顶级函数
            。

        </p>

        <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        <h3 id="express.methods">

            方法

        </h3>

        <section>
            <h3 id="express.json" class="h2">

                express.json（[选项]）

            </h3>

            <div class="doc-box doc-info">
                <p>

                    此中间件在Express v4.16.0及更高版本中可用。

                </p>
            </div>

            <p>

                这是Express中的内置中间件函数。
                它使用JSON有效负载解析传入的请求，并基于

                <a href="/en/resources/middleware/body-parser.html">

                    正文解析器

                </a>

                。

            </p>

            <p>

                返回仅解析JSON的中间件，仅查看
                <code>Content-Type</code>

                标头与
                <code>type</code>

                选项
                匹配的
                请求
                。
                此解析器接受正文的任何​​Unicode编码，并支持自动充气
                <code>gzip</code>

                和

                <code>deflate</code>

                编码。

            </p>

            <p>


                在中间件（即
                ）
                之后
                <code>body</code>

                ，在
                <code>request</code>

                对象
                上填充包含已解析数据的
                新
                对象
                <code>req.body</code>

                ，
                <code>{}</code>

                如果没有要解析的主体，
                <code>Content-Type</code>

                未匹配或发生错误，
                则填充
                空对象（
                ）
                。

            </p>

            <div class="doc-box doc-warn">
                <p>

                    由于
                    <code>req.body</code>

                    形状基于用户控制的输入，因此该对象中的所有属性和值都是不可信的，应在信任之前进行验证。
                    例如，
                    <code>req.body.foo.toString()</code>

                    可能以多种方式失败，例如

                    <code>foo</code>

                    可能不存在或者可能不是字符串，并且
                    <code>toString</code>

                    可能不是函数而是字符串或其他用户输入。

                </p>
            </div>

            <p>

                下表描述了可选
                <code>options</code>

                对象
                的属性
                。

            </p>

            <table>
                <thead>
                    <tr>
                        <th>

                            属性

                        </th>
                        <th>

                            描述

                        </th>
                        <th>

                            类型

                        </th>
                        <th>

                            默认

                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>inflate</code></td>
                        <td>

                            启用或禁用处理缩小（压缩）的主体;
                            禁用时，放气的身体会被拒绝。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>limit</code></td>
                        <td>

                            控制最大请求体大小。
                            如果这是一个数字，则该值指定字节数;
                            如果它是一个字符串，则将值传递给
                            <a href="https://www.npmjs.com/package/bytes">

                                字节

                            </a>

                            库以进行解析。

                        </td>
                        <td>

                            杂

                        </td>
                        <td><code>"100kb"</code></td>
                    </tr>
                    <tr>
                        <td><code>reviver</code></td>
                        <td>

                            该
                            <code>reviver</code>

                            选项直接传递给
                            <code>JSON.parse</code>

                            第二个参数。
                            您可以
                            <a
                                href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Example.3A_Using_the_reviver_parameter">

                                在有关JSON.parse的MDN文档中

                            </a>

                            找到有关此参数的更多信息
                            。

                        </td>
                        <td>

                            函数

                        </td>
                        <td><code>null</code></td>
                    </tr>
                    <tr>
                        <td><code>strict</code></td>
                        <td>

                            启用或禁用仅接受数组和对象;
                            禁用时会接受任何
                            <code>JSON.parse</code>

                            接受。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>type</code></td>
                        <td>

                            这用于确定中间件将解析的媒体类型。
                            此选项可以是字符串，字符串数组或函数。
                            如果不是函数，则
                            <code>type</code>

                            选项直接传递给
                            <a href="https://www.npmjs.org/package/type-is#readme">

                                type-is

                            </a>

                            库，这可以是扩展名（如
                            <code>json</code>

                            ），mime类型（如
                            <code>application/json</code>

                            ），或带有通配符的mime类型（如
                            <code>*/*</code>

                            或
                            <code>*/json</code>

                            ）。
                            如果是一个函数，
                            <code>type</code>

                            则调用
                            该
                            选项
                            <code>fn(req)</code>

                            ，如果返回一个truthy值，则解析该请求。

                        </td>
                        <td>

                            杂

                        </td>
                        <td><code>"application/json"</code></td>
                    </tr>
                    <tr>
                        <td><code>verify</code></td>
                        <td>

                            此选项（如果提供）被称为
                            <code>verify(req, res, buf, encoding)</code>

                            ，其中
                            <code>buf</code>

                            是
                            <code>Buffer</code>

                            原始请求主体的
                            一个
                            ，并且
                            <code>encoding</code>

                            是
                            请求
                            的编码。
                            抛出错误可以中止解析。

                        </td>
                        <td>

                            函数

                        </td>
                        <td><code>undefined</code></td>
                    </tr>
                </tbody>
            </table>

        </section>

        <section>
            <h3 id="express.static" class="h2">

                express.static（root，[options]）

            </h3>

            <p>

                这是Express中的内置中间件函数。
                它提供静态文件，基于
                <a href="/en/resources/middleware/serve-static.html">

                    serve-static

                </a>

                。

            </p>

            <div class="doc-box doc-info">
                <p>

                    注意：为获得最佳结果，请
                    <a href="/en/advanced/best-practice-performance.html#use-a-reverse-proxy">

                        使用反向代理

                    </a>

                    缓存来提高服务静态资产的性能。

                </p>
            </div>

            <p>

                该
                <code>root</code>

                参数指定从中提供静态资产的根目录。
                该函数通过
                <code>req.url</code>

                与提供的
                <code>root</code>

                目录
                组合来确定要
                提供的
                文件。
                当找不到文件时，它不是发送404响应，而是调用
                <code>next()</code>


                继续下一个中间件，允许堆叠和回退。

            </p>

            <p>

                下表描述了
                <code>options</code>

                对象
                的属性
                。
                另请参见
                <a href="#example.of.express.static">

                    下面

                </a>

                的<a href="#example.of.express.static">
                    示例
                </a>
                。

            </p>

            <table>
                <thead>
                    <tr>
                        <th>

                            属性

                        </th>
                        <th>

                            描述

                        </th>
                        <th>

                            类型

                        </th>
                        <th>

                            默认

                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>dotfiles</code></td>
                        <td>

                            确定如何处理dotfiles（以点“。”开头的文件或目录）。
                            <br><br>

                            请参阅
                            下面的
                            <a href="#dotfiles">

                                dotfiles

                            </a>

                            。

                        </td>
                        <td>

                            串

                        </td>
                        <td>“ignore”</td>
                    </tr>
                    <tr>
                        <td><code>etag</code></td>
                        <td>

                            启用或禁用etag生成
                            <br><br>

                            注意：
                            <code>express.static</code>

                            始终发送弱ETag。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>extensions</code></td>
                        <td>

                            设置文件扩展名回退：如果找不到文件，请搜索具有指定扩展名的文件并提供找到的第一个文件。

                            示例：
                            <code>['html', 'htm']</code>

                            。

                        </td>
                        <td>

                            杂

                        </td>
                        <td><code>false</code></td>
                    </tr>
                    <tr>
                        <td><code>fallthrough</code></td>
                        <td>

                            让客户端错误成为未处理的请求，否则转发客户端错误。
                            <br><br>

                            见
                            下面的
                            <a href="#fallthrough">

                                见解

                            </a>

                            。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>immutable</code></td>
                        <td>
                            <code>immutable</code>

                            在
                            <code>Cache-Control</code>

                            响应头中
                            启用或禁用该
                            指令
                            。
                            如果启用，
                            <code>maxAge</code>

                            还应指定
                            该
                            选项以启用缓存。
                            该
                            <code>immutable</code>

                            指令将阻止受支持的客户端在
                            <code>maxAge</code>

                            选项
                            的生命周期内发出条件请求，
                            以检查文件是否已更改。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>false</code></td>
                    </tr>
                    <tr>
                        <td><code>index</code></td>
                        <td>

                            发送指定的目录索引文件。
                            设置为
                            <code>false</code>

                            禁用目录索引。

                        </td>
                        <td>

                            杂

                        </td>
                        <td>“index.html”</td>
                    </tr>
                    <tr>
                        <td><code>lastModified</code></td>
                        <td>

                            将
                            <code>Last-Modified</code>

                            标头
                            设置
                            为OS上文件的上次修改日期。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>maxAge</code></td>
                        <td>

                            设置Cache-Control标头的max-age属性（以毫秒为单位）或字符串（以
                            <a href="https://www.npmjs.org/package/ms">ms格式</a>

                            ）。

                        </td>
                        <td>

                            数

                        </td>
                        <td>

                            0

                        </td>
                    </tr>
                    <tr>
                        <td><code>redirect</code></td>
                        <td>

                            当路径名是目录时，重定向到尾随“/”。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>setHeaders</code></td>
                        <td>

                            用于设置HTTP标头以与文件一起提供的函数。
                            <br><br>

                            请参阅
                            下面的
                            <a href="#setHeaders">

                                setHeaders

                            </a>

                            。

                        </td>
                        <td>

                            函数

                        </td>
                        <td>&nbsp;</td>
                    </tr>
                </tbody>
            </table>

            <p>

                有关更多信息，请参阅
                <a href="/starter/static-files.html">

                    在Express中提供静态文件

                </a>

                。
                和
                <a href="/en/guide/using-middleware.html#middleware.built-in">

                    使用中间件 - 内置中间件

                </a>

                。

            </p>

            <h5 id="dotfiles">

                点文件

            </h5>

            <p>

                此选项的可能值为：

            </p>

            <ul>
                <li>

                    “允许” - 对dotfiles没有特殊处理。

                </li>
                <li>

                    “拒绝” - 拒绝对点文件的请求，回复
                    <code>403</code>

                    ，然后调用
                    <code>next()</code>

                    。

                </li>
                <li>

                    “忽略” - 就像dotfile不存在一样，回复
                    <code>404</code>

                    ，然后调用
                    <code>next()</code>

                    。

                </li>
            </ul>

            <p><strong>

                    注意

                </strong>

                ：使用默认值时，它不会忽略以点开头的目录中的文件。

            </p>

            <h5 id="fallthrough">

                下通

            </h5>

            <p>

                当此选项出现时
                <code>true</code>

                ，客户端错误（例如错误请求或对不存在文件的请求）将导致此中间件仅调用
                <code>next()</code>

                以调用堆栈中的下一个中间件。
                如果为false，则会调用这些错误（甚至404）
                <code>next(err)</code>

                。

            </p>

            <p>

                将此选项设置为，
                <code>true</code>

                以便您可以将多个物理目录映射到同一Web地址或路由以填充不存在的文件。

            </p>

            <p>
                <code>false</code>

                如果您已将此中间件安装在严格设计为单个文件系统目录的路径上，则可以
                使用
                此选项，从而允许短路404以减少开销。
                该中间件也将回复所有方法。

            </p>

            <h5 id="setHeaders">

                setHeaders

            </h5>

            <p>

                对于此选项，请指定用于设置自定义响应标头的函数。
                标头的更改必须同步进行。

            </p>

            <p>

                该函数的签名是：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token function">fn<span class="token punctuation">(</span></span>res<span class="token punctuation">,</span> path<span class="token punctuation">,</span> stat<span class="token punctuation">)</span>
      </code></pre>

            <p>

                参数：

            </p>

            <ul>
                <li><code>res</code>

                    ，
                    <a href="#res" class="active">

                        响应对象

                    </a>

                    。

                </li>
                <li><code>path</code>

                    ，正在发送的文件路径。

                </li>
                <li><code>stat</code>

                    ，
                    <code>stat</code>

                    正在发送的文件
                    的
                    对象。

                </li>
            </ul>

            <h4 id="example.of.express.static">

                express.static的例子

            </h4>

            <p>

                以下是使用
                <code>express.static</code>

                精心设计的选项对象
                的
                中间件函数
                的示例
                ：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        dotfiles<span class="token punctuation">:</span> <span class="token string">'ignore'</span><span class="token punctuation">,</span>
        etag<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
        extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'htm'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        index<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
        maxAge<span class="token punctuation">:</span> <span class="token string">'1d'</span><span class="token punctuation">,</span>
        redirect<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
        setHeaders<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">,</span> path<span class="token punctuation">,</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'x-timestamp'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span>
      </code></pre>

        </section>

        <section>
            <h3 id="express.router" class="h2">

                express.Router（[选项]）

            </h3>

            <p>

                创建一个新的
                <a href="#router" class="active">

                    路由器

                </a>

                对象。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                可选
                <code>options</code>

                参数指定路由器的行为。

            </p>

            <div class="table-scroller">

                <table>
                    <thead>
                        <tr>
                            <th>

                                属性

                            </th>
                            <th>

                                描述

                            </th>
                            <th>

                                默认

                            </th>
                            <th>

                                可用性

                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>caseSensitive</code></td>
                            <td>

                                启用区分大小写。

                            </td>
                            <td>

                                默认情况下禁用，将“/ Foo”和“/ foo”视为相同。

                            </td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td><code>mergeParams</code></td>
                            <td>

                                保留
                                <code>req.params</code>

                                父路由器
                                的
                                值。
                                如果父级和子级具有冲突的参数名称，则子级的值优先。

                            </td>
                            <td><code>false</code></td>
                            <td>

                                4.5.0+

                            </td>
                        </tr>
                        <tr>
                            <td><code>strict</code></td>
                            <td>

                                启用严格路由。

                            </td>
                            <td>

                                默认情况下禁用，“/ foo”和“/ foo /”由路由器处理相同。

                            </td>
                            <td>&nbsp;</td>
                        </tr>
                    </tbody>
                </table>

            </div>

            <p>

                您可以添加中间件和HTTP方法路由（如
                <code>get</code>

                ，
                <code>put</code>

                ，
                <code>post</code>

                ，等），以
                <code>router</code>

                就像一个应用程序。

            </p>

            <p>

                有关更多信息，请参阅
                <a href="#router" class="active">

                    路由器

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="express.urlencoded" class="h2">

                express.urlencoded（[选项]）

            </h3>

            <div class="doc-box doc-info">
                <p>

                    此中间件在Express v4.16.0及更高版本中可用。

                </p>
            </div>

            <p>

                这是Express中的内置中间件函数。
                它使用urlencoded有效负载解析传入的请求，并基于
                <a href="/en/resources/middleware/body-parser.html">

                    正文解析器

                </a>

                。

            </p>

            <p>

                返回仅解析urlencoded主体的中间件，仅查看
                <code>Content-Type</code>

                标头与
                <code>type</code>

                选项
                匹配的
                请求
                。
                此解析器仅接受正文的UTF-8编码，并支持自动充气
                <code>gzip</code>

                和
                <code>deflate</code>

                编码。

            </p>

            <p>


                在中间件（即
                ）
                之后
                <code>body</code>

                ，在
                <code>request</code>

                对象
                上填充包含已解析数据的
                新
                对象
                <code>req.body</code>

                ，
                <code>{}</code>

                如果没有要解析的主体，
                <code>Content-Type</code>

                未匹配或发生错误，
                则填充
                空对象（
                ）
                。
                此对象将包含键值对，其中值可以是字符串或数组（何时
                <code>extended</code>

                为
                <code>false</code>

                ），或任何类型（何时
                <code>extended</code>


                为
                <code>true</code>

                ）。

            </p>

            <div class="doc-box doc-warn">
                <p>

                    由于
                    <code>req.body</code>

                    形状基于用户控制的输入，因此该对象中的所有属性和值都是不可信的，应在信任之前进行验证。
                    例如，
                    <code>req.body.foo.toString()</code>

                    可能以多种方式失败，例如

                    <code>foo</code>

                    可能不存在或者可能不是字符串，并且
                    <code>toString</code>

                    可能不是函数而是字符串或其他用户输入。

                </p>
            </div>

            <p>

                下表描述了可选
                <code>options</code>

                对象
                的属性
                。

            </p>

            <table>
                <thead>
                    <tr>
                        <th>

                            属性

                        </th>
                        <th>

                            描述

                        </th>
                        <th>

                            类型

                        </th>
                        <th>

                            默认

                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>extended</code></td>
                        <td>

                            此选项允许选择使用
                            <code>querystring</code>

                            库（何时
                            <code>false</code>

                            ）或
                            <code>qs</code>

                            库（何时
                            <code>true</code>

                            ）
                            解析URL编码数据
                            。
                            “扩展”语法允许将富对象和数组编码为URL编码格式，从而允许使用URL编码的类似JSON的体验。

                            有关更多信息，请
                            <a href="https://www.npmjs.org/package/qs#readme">

                                参阅qs库

                            </a>

                            。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>inflate</code></td>
                        <td>

                            启用或禁用处理缩小（压缩）的主体;
                            禁用时，放气的身体会被拒绝。

                        </td>
                        <td>

                            布尔

                        </td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>limit</code></td>
                        <td>

                            控制最大请求体大小。
                            如果这是一个数字，则该值指定字节数;
                            如果它是一个字符串，则将值传递给
                            <a href="https://www.npmjs.com/package/bytes">

                                字节

                            </a>

                            库以进行解析。

                        </td>
                        <td>

                            杂

                        </td>
                        <td><code>"100kb"</code></td>
                    </tr>
                    <tr>
                        <td><code>parameterLimit</code></td>
                        <td>

                            此选项控制URL编码数据中允许的最大参数数。
                            如果请求包含的参数多于此值，则会引发错误。

                        </td>
                        <td>

                            数

                        </td>
                        <td><code>1000</code></td>
                    </tr>
                    <tr>
                        <td><code>type</code></td>
                        <td>

                            这用于确定中间件将解析的媒体类型。
                            此选项可以是字符串，字符串数组或函数。
                            如果不是函数，则
                            <code>type</code>

                            选项直接传递给
                            <a href="https://www.npmjs.org/package/type-is#readme">

                                type-is

                            </a>

                            库，这可以是扩展名（如
                            <code>urlencoded</code>

                            ），mime类型（如
                            <code>application/x-www-form-urlencoded</code>

                            ），或带有通配符的mime类型（如
                            <code>*/x-www-form-urlencoded</code>

                            ）。
                            如果是一个函数，
                            <code>type</code>

                            则调用
                            该
                            选项
                            <code>fn(req)</code>

                            ，如果返回一个truthy值，则解析该请求。

                        </td>
                        <td>

                            杂

                        </td>
                        <td><code>"application/x-www-form-urlencoded"</code></td>
                    </tr>
                    <tr>
                        <td><code>verify</code></td>
                        <td>

                            此选项（如果提供）被称为
                            <code>verify(req, res, buf, encoding)</code>

                            ，其中
                            <code>buf</code>

                            是
                            <code>Buffer</code>

                            原始请求主体的
                            一个
                            ，并且
                            <code>encoding</code>

                            是
                            请求
                            的编码。
                            抛出错误可以中止解析。

                        </td>
                        <td>

                            函数

                        </td>
                        <td><code>undefined</code></td>
                    </tr>
                </tbody>
            </table>

        </section>

        <h2 id="app">

            应用

        </h2>

        <p>

            该
            <code>app</code>

            对象通常表示Express应用程序。
            通过调用
            <code>express()</code>

            Express模块​​导出
            的顶级
            函数来
            创建它
            ：

        </p>

        <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        <p>

            该
            <code>app</code>

            对象有方法

        </p>

        <ul>
            <li>

                路由HTTP请求;
                例如，请参阅
                <a href="#app.METHOD" class="active">

                    app.METHOD

                </a>

                和
                <a href="#app.param" class="active">

                    app.param

                </a>

                。

            </li>
            <li>

                配置中间件;
                看
                <a href="#app.route">

                    app.route

                </a>

                。

            </li>
            <li>

                渲染HTML视图;
                看到
                <a href="#app.render" class="active">

                    app.render

                </a>

                。

            </li>
            <li>

                注册模板引擎;
                看
                <a href="#app.engine" class="active">

                    app.engine

                </a>

                。

            </li>
        </ul>

        <p>

            它还具有影响应用程序行为方式的设置（属性）;
            有关详细信息，请参阅
            <a href="#app.settings.table">

                应用程序设置

            </a>

            。

        </p>

        <div class="doc-box doc-info">
            <p>

                的Express应用程序对象可以从被称为
                <a href="#req" class="active">

                    请求对象

                </a>

                和
                <a href="#res" class="active">

                    响应对象

                </a>

                如
                <code>req.app</code>

                ，和
                <code>res.app</code>

                分别。

            </p>
        </div>

        <h3 id="app.properties">

            属性

        </h3>

        <section>
            <h3 id="app.locals">

                app.locals

            </h3>

            <p>

                该
                <code>app.locals</code>

                对象具有属性，这些属性是应用程序中的局部变量。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>title
      <span class="token comment" spellcheck="true">// =&gt; 'My App'
      </span>
      app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>email
      <span class="token comment" spellcheck="true">// =&gt; 'me@myapp.com'
      </span></code></pre>

            <p>

                设置后，
                <code>app.locals</code>

                属性
                值将
                在应用程序的整个生命周期中保持
                <a href="#res.locals" class="active">

                    不变

                </a>

                ，
                而<a href="#res.locals" class="active">
                    res.locals
                </a>
                属性仅在请求的生命周期内有效。

            </p>

            <p>

                您可以在应用程序中呈现的模板中访问局部变量。
                这对于为模板提供辅助函数以及应用程序级数据非常有用。
                中间件中可以使用局部变量
                <code>req.app.locals</code>

                （参见
                <a href="#req.app" class="active">

                    req.app

                </a>

                ）

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'My App'</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>strftime <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'strftime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">'me@myapp.com'</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.mountpath">

                app.mountpath

            </h3>

            <p>

                该
                <code>app.mountpath</code>

                属性包含一个或多个安装了子应用程序的路径模式。

            </p>

            <div class="doc-box doc-info">
                <p>

                    子应用程序是
                    <code>express</code>

                    可以用于处理对路由的请求
                    的实例
                    。

                </p>
            </div>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// the main app
      </span><span class="token keyword">var</span> admin <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// the sub app
      </span>
      admin<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>admin<span class="token punctuation">.</span>mountpath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /admin
      </span>  res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Admin Homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/admin'</span><span class="token punctuation">,</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// mount the sub app
      </span></code></pre>

            <p>

                它类似于
                对象
                的
                <a href="#req.baseUrl" class="active">

                    baseUrl

                </a>

                属性
                <code>req</code>

                ，除了
                <code>req.baseUrl</code>


                返回匹配的URL路径，而不是匹配的模式。

            </p>

            <p>

                如果子应用程序安装在多个路径模式上，则
                <code>app.mountpath</code>

                返回其安装的模式列表，如以下示例所示。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> admin <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      admin<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>admin<span class="token punctuation">.</span>mountpath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [ '/adm*n', '/manager' ]
      </span>  res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Admin Homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">var</span> secret <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      secret<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>secret<span class="token punctuation">.</span>mountpath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /secr*t
      </span>  res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Admin Secret'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      admin<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/secr*t'</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// load the 'secret' router on '/secr*t', on the 'admin' sub app
      </span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'/adm*n'</span><span class="token punctuation">,</span> <span class="token string">'/manager'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// load the 'admin' router on '/adm*n' and '/manager', on the parent app
      </span></code></pre>

        </section>

        <h3 id="app.events">

            活动

        </h3>

        <section>
            <h3 id="app.onmount">

                app.on（'mount'，callback（parent））

            </h3>

            <p>
                <code>mount</code>

                当子应用程序挂载在父应用程序上时，会触发
                该
                事件。
                父应用程序将传递给回调函数。

            </p>

            <div class="doc-box doc-info">
                <p><strong>

                        注意

                    </strong></p>

                <p>

                    子应用程序将：

                </p>

                <ul>
                    <li>

                        不继承具有默认值的设置的值。
                        您必须在子应用程序中设置该值。

                    </li>
                    <li>

                        继承没有默认值的设置值。

                    </li>
                </ul>

                <p>

                    有关详细信息，请参阅
                    <a href="/en/4x/api.html#app.settings.table">

                        应用程序设置

                    </a>

                    。

                </p>
            </div>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> admin <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      admin<span class="token punctuation">.</span><span class="token function">on<span class="token punctuation">(</span></span><span class="token string">'mount'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'Admin Mounted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// refers to the parent app
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      admin<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Admin Homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/admin'</span><span class="token punctuation">,</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <h3 id="app.methods">

            方法

        </h3>

        <section>
            <h3 id="app.all">

                app.all（path，callback [，callback ...]）

            </h3>

            <p>

                此方法类似于标准的
                <a href="#app.METHOD" class="active">

                    app.METHOD（）

                </a>

                方法，但它匹配所有HTTP谓词。

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <h4 id="examples">

                例子

            </h4>

            <p>

                对于
                <code>/secret</code>

                是否使用GET，POST，PUT，DELETE或任何其他HTTP请求方法的
                请求，将执行以下回调
                ：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'/secret'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'Accessing the secret section ...'</span><span class="token punctuation">)</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// pass control to the next handler
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                该
                <code>app.all()</code>

                方法对于映射特定路径前缀或任意匹配的“全局”逻辑非常有用。
                例如，如果将以下内容放在所有其他路由定义的顶部，则需要从该点开始的所有路由都需要身份验证，并自动加载用户。
                请记住，这些回调不必充当终点：
                <code>loadUser</code>


                可以执行任务，然后调用
                <code>next()</code>

                以继续匹配后续路由。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'*'</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                或等效的：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'*'</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'*'</span><span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                另一个例子是白名单的“全局”函数。
                该示例与上面的示例类似，但它仅限制以“/ api”开头的路径：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'/api/*'</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.delete.method">

                app.delete（path，callback [，callback ...]）

            </h3>

            <p>

                使用指定的回调函数将HTTP DELETE请求路由到指定的路径。
                有关更多信息，请参阅
                <a href="/guide/routing.html">

                    路由指南

                </a>

                。

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <h4 id="example">

                例

            </h4>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'DELETE request to homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.disable">

                app.disable（名称）

            </h3>

            <p>

                将布尔值设置
                <code>name</code>

                为
                <code>false</code>

                ，其中
                <code>name</code>

                是
                <a href="#app.settings.table">

                    应用程序设置表中的

                </a>

                一个属性
                。
                调用
                <code>app.set('foo', false)</code>

                Boolean属性与调用相同
                <code>app.disable('foo')</code>

                。

            </p>

            <p>

                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">disable<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; false
      </span></code></pre>

        </section>

        <section>
            <h3 id="app.disabled">

                app.disabled（名称）

            </h3>

            <p>
                <code>true</code>

                如果布尔设置
                <code>name</code>

                被禁用（
                <code>false</code>

                ），
                <code>name</code>

                则
                返回
                ，其中
                是
                <a href="#app.settings.table">

                    应用程序设置表中的

                </a>

                一个属性
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">disabled<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; true
      </span>
      app<span class="token punctuation">.</span><span class="token function">enable<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">disabled<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; false
      </span></code></pre>

        </section>

        <section>
            <h3 id="app.enable">

                app.enable（名称）

            </h3>

            <p>

                将布尔值设置
                <code>name</code>

                为
                <code>true</code>

                ，其中
                <code>name</code>

                是
                <a href="#app.settings.table">

                    应用程序设置表中的

                </a>

                一个属性
                。
                调用
                <code>app.set('foo', true)</code>

                Boolean属性与调用相同
                <code>app.enable('foo')</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">enable<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; true
      </span></code></pre>

        </section>

        <section>
            <h3 id="app.enabled">

                app.enabled（名称）

            </h3>

            <p>
                <code>true</code>

                如果设置
                <code>name</code>

                已启用（
                <code>true</code>

                ），
                则
                返回
                ，其中
                <code>name</code>

                是
                <a href="#app.settings.table">

                    应用程序设置表中的

                </a>

                一个属性
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">enabled<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; false
      </span>
      app<span class="token punctuation">.</span><span class="token function">enable<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">enabled<span class="token punctuation">(</span></span><span class="token string">'trust proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; true
      </span></code></pre>

        </section>

        <section>
            <h3 id="app.engine">

                app.engine（分机，回拨）

            </h3>

            <p>

                将给定的模板引擎注册
                <code>callback</code>

                为
                <code>ext</code>

                。

            </p>

            <p>

                默认情况下，Express会
                <code>require()</code>

                根据文件扩展名引擎。
                例如，如果您尝试呈现“foo.pug”文件，Express会在内部调用以下内容，并缓存
                <code>require()</code>

                后续调用以提高性能。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">engine<span class="token punctuation">(</span></span><span class="token string">'pug'</span><span class="token punctuation">,</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'pug'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__express<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                对于未提供
                <code>.__express</code>

                开箱
                即用的引擎
                ，或者您希望将不同的扩展“映射”到模板
                引擎，请使用此方法
                。

            </p>

            <p>

                例如，要将EJS模板引擎映射到“.html”文件：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">engine<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>renderFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在这种情况下，EJS提供了
                <code>.renderFile()</code>

                一种具有与Express期望相同的签名
                的
                方法：
                <code>(path, options, callback)</code>

                尽管注意它在
                <code>ejs.__express</code>

                内部
                将此方法别名，
                因此如果您使用“.ejs”扩展，则不需要执行任何操作。

            </p>

            <p>

                某些模板引擎不遵循此约定。
                该

                <a href="https://github.com/tj/consolidate.js">

                    consolidate.js

                </a>

                图书馆地图节点模板引擎要遵守这个习惯，所以他们与快递无缝协作。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> engines <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'consolidate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">engine<span class="token punctuation">(</span></span><span class="token string">'haml'</span><span class="token punctuation">,</span> engines<span class="token punctuation">.</span>haml<span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">engine<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">,</span> engines<span class="token punctuation">.</span>hogan<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.get">

                app.get（名称）

            </h3>

            <p>

                返回
                <code>name</code>

                app setting
                的值
                ，其中
                <code>name</code>

                是
                <a href="#app.settings.table">

                    app settings表

                </a>

                中的一个字符串

                。
                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; undefined
      </span>
      app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'My Site'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "My Site"
      </span></code></pre>

        </section>

        <section>
            <h3 id="app.get.method">

                app.get（path，callback [，callback ...]）

            </h3>

            <p>

                使用指定的回调函数将HTTP GET请求路由到指定的路径。

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <p>

                有关更多信息，请参阅
                <a href="/guide/routing.html">

                    路由指南

                </a>

                。

            </p>

            <h4 id="example-1">

                例

            </h4>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'GET request to homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.listen_path_callback">

                app.listen（path，[callback]）

            </h3>

            <p>

                启动UNIX套接字并侦听给定路径上的连接。
                此方法与Node的
                <a href="https://nodejs.org/api/http.html#http_server_listen">

                    http.Server.listen（）

                </a>

                相同
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token string">'/tmp/sock'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <h3 id="app.listen">

                app.listen（[port [，host [，backlog]]] [，callback]）

            </h3>

            <p>

                绑定并侦听指定主机和端口上的连接。
                此方法与Node的
                <a href="https://nodejs.org/api/http.html#http_server_listen">

                    http.Server.listen（）

                </a>

                相同
                。

            </p>

            <p>

                如果port被省略或为0，操作系统将分配一个任意未使用的端口，这对于自动化任务（测试等）的情况很有用。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在
                <code>app</code>

                返回的
                <code>express()</code>

                实际上是一个JavaScript

                <code>Function</code>

                ，旨在传递到节点的HTTP服务器作为一个回调来处理请求。
                这样可以轻松地为应用程序的HTTP和HTTPS版本提供相同的代码库，因为应用程序不会从这些版本继承（它只是一个回调）：


            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> https <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      http<span class="token punctuation">.</span><span class="token function">createServer<span class="token punctuation">(</span></span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      https<span class="token punctuation">.</span><span class="token function">createServer<span class="token punctuation">(</span></span>options<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                该
                <code>app.listen()</code>

                方法返回一个
                <a href="https://nodejs.org/api/http.html#http_class_http_server">

                    http.Server

                </a>

                对象，（对于HTTP）是以下方便的方法：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span>listen <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer<span class="token punctuation">(</span></span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> server<span class="token punctuation">.</span>listen<span class="token punctuation">.</span><span class="token function">apply<span class="token punctuation">(</span></span>server<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      </code></pre>

            <div class="doc-box doc-info">
                <p>

                    注意：

                    事实上，实际上支持
                    Node的
                    <a href="https://nodejs.org/api/http.html#http_server_listen">

                        http.Server.listen（）

                    </a>

                    方法的
                    所有形式

                    。

                </p>
            </div>

        </section>

        <section>
            <h3 id="app.METHOD">

                app.METHOD（path，callback [，callback ...]）

            </h3>

            <p>

                路由HTTP请求，其中METHOD是请求的HTTP方法，例如GET，PUT，POST等，以小写形式。
                因此，实际的方法是
                <code>app.get()</code>

                ，

                <code>app.post()</code>

                ，
                <code>app.put()</code>

                ，等等。
                有关
                完整列表，
                请参阅
                下面的
                <a href="#routing-methods">

                    路由方法

                </a>

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <h4 id="routing-methods">

                路由方法

            </h4>

            <p>

                Express支持以下与相同名称的HTTP方法对应的路由方法：

            </p>

            <table style="border: 0px; background: none">
                <tbody>
                    <tr>
                        <td style="background: none; border: 0px;">
                            <ul>
                                <li><code>checkout</code></li>
                                <li><code>copy</code></li>
                                <li><code>delete</code></li>
                                <li><code>get</code></li>
                                <li><code>head</code></li>
                                <li><code>lock</code></li>
                                <li><code>merge</code></li>
                                <li><code>mkactivity</code></li>
                            </ul>
                        </td>
                        <td style="background: none; border: 0px;">
                            <ul>
                                <li><code>mkcol</code></li>
                                <li><code>move</code></li>
                                <li><code>m-search</code></li>
                                <li><code>notify</code></li>
                                <li><code>options</code></li>
                                <li><code>patch</code></li>
                                <li><code>post</code></li>
                            </ul>
                        </td>
                        <td style="background: none; border: 0px;">
                            <ul>
                                <li><code>purge</code></li>
                                <li><code>put</code></li>
                                <li><code>report</code></li>
                                <li><code>search</code></li>
                                <li><code>subscribe</code></li>
                                <li><code>trace</code></li>
                                <li><code>unlock</code></li>
                                <li><code>unsubscribe</code></li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>

            <p>

                该API文档中有明确的项目只针对最流行的HTTP方法
                <code>app.get()</code>

                ，

                <code>app.post()</code>

                ，
                <code>app.put()</code>

                ，和
                <code>app.delete()</code>

                。
                但是，上面列出的其他方法的工作方式完全相同。

            </p>

            <p>

                要路由转换为无效JavaScript变量名称的方法，请使用括号表示法。
                例如，
                <code>app['m-search']('/', function ...</code>

                。

            </p>

            <div class="doc-box doc-info">
                <p>

                    除了
                    之前未为路径调用
                    的

                    方法
                    之外，还会
                    <code>app.get()</code>

                    自动为HTTP
                    <code>HEAD</code>

                    方法
                    调用
                    该
                    函数
                    。
                    <code>GET</code>
                    <code>app.head()</code>
                    <code>app.get()</code>

                </p>
            </div>

            <p>

                该方法
                <code>app.all()</code>

                不是从任何HTTP方法派生的，而是在指定路径上为
                <em>

                    所有

                </em>

                HTTP请求方法
                加载中间件
                。
                有关更多信息，请参阅
                <a href="#app.all" class="active">

                    app.all

                </a>

                。

            </p>

            <p>

                有关路由的详细信息，请参阅
                <a href="/guide/routing.html">

                    路由指南

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="app.param">

                app.param（[name]，callback）

            </h3>

            <p>

                添加回调触发器以
                <a href="/en/guide/routing.html#route-parameters">

                    路由参数

                </a>

                ，其中
                <code>name</code>

                是<a href="/en/guide/routing.html#route-parameters">
                    参数
                </a>
                的名称或其数组，并且
                <code>callback</code>

                是回调函数。
                回调函数的参数是请求对象，响应对象，下一个中间件，参数的值和参数的名称。

            </p>

            <p>

                如果
                <code>name</code>

                是数组，
                <code>callback</code>

                则按声明的顺序为其中声明的每个参数注册触发器。
                此外，对于除最后一个之外的每个声明的参数，
                <code>next</code>

                对回调内部的调用将调用下一个声明的参数的回调。
                对于最后一个参数，调用
                <code>next</code>

                将为当前正在处理的路由调用下一个中间件，就像它
                <code>name</code>

                只是一个字符串一样。

            </p>

            <p>

                例如，当
                <code>:user</code>

                路径路径中存在
                时
                ，您可以映射用户加载逻辑以自动提供
                <code>req.user</code>

                给路径，或者对参数输入执行验证。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
        <span class="token comment" spellcheck="true">// try to get the user details from the User model and attach it to the request object
      </span>  User<span class="token punctuation">.</span><span class="token function">find<span class="token punctuation">(</span></span>id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            req<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'failed to load user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                Param回调函数是定义它们的路由器的本地函数。
                它们不是由已安装的应用程序或路由器继承的。
                因此，定义的参数回调
                <code>app</code>

                只能由路由上定义的路由参数触发
                <code>app</code>

                。

            </p>

            <p>

                所有param回调都将在param发生的任何路由的任何处理程序之前被调用，并且它们将在请求 -
                响应循环中仅被调用一次，即使参数在多个路由中匹配，如以下示例所示。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'CALLED ONLY ONCE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'although this matches'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'and this matches too'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在
                <code>GET /user/42</code>

                ，打印以下内容：

            </p>

            <pre class="language-sh"><code class="language-sh">CALLED ONLY ONCE
      although this matches
      and this matches too
      </code></pre>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'CALLED ONLY ONCE with'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id/:page'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'although this matches'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id/:page'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'and this matches too'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在
                <code>GET /user/42/3</code>

                ，打印以下内容：

            </p>

            <pre class="language-sh"><code class="language-sh">CALLED ONLY ONCE with 42
      CALLED ONLY ONCE with 3
      although this matches
      and this matches too
      </code></pre>

            <div class="doc-box doc-warn">
                <p>

                    以下部分介绍
                    <code>app.param(callback)</code>

                    了自v4.11.0起不推荐使用的内容。

                </p>
            </div>

            <p>
                <code>app.param(name, callback)</code>

                通过仅传递函数可以完全改变方法
                的行为
                <code>app.param()</code>

                。
                这个函数是
                <code>app.param(name, callback)</code>

                应该
                如何
                表现
                的自定义实现
                - 它接受两个参数并且必须返回一个中间件。

            </p>

            <p>

                此函数的第一个参数是应捕获的URL参数的名称，第二个参数可以是可用于返回中间件实现的任何JavaScript对象。


            </p>

            <p>

                函数返回的中间件决定捕获URL参数时发生的行为。

            </p>

            <p>

                在此示例中，
                <code>app.param(name, callback)</code>

                签名被修改为
                <code>app.param(name, accessId)</code>

                。
                <code>app.param()</code>

                现在接受姓名和号码
                ，而不是接受姓名和回调
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// customizing the behavior of app.param()
      </span>app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token string">'route'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// using the customized app.param()
      </span>app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// route to trigger the capture
      </span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'Ready'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在此示例中，
                <code>app.param(name, callback)</code>

                签名保持不变，但是代替中间件回调，已定义自定义数据类型检查函数以验证用户ID的数据类型。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validator<span class="token punctuation">(</span></span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token string">'route'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isNaN<span class="token punctuation">(</span></span><span class="token function">parseFloat<span class="token punctuation">(</span></span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFinite<span class="token punctuation">(</span></span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <div class="doc-box doc-info">
                <p>

                    '
                    <code>.</code>

                    '字符不能用于捕获捕获正则表达式中的字符。
                    例如，您不能用于
                    <code>'/user-.+/'</code>

                    捕获
                    <code>'users-gami'</code>

                    ，使用
                    <code>[\\s\\S]</code>

                    或
                    <code>[\\w\\W]</code>

                    替代（如
                    <code>'/user-[\\s\\S]+/'</code>

                    。

                </p>

                <p>

                    例子：

                </p>

                <pre class="  language-javascript"><code class="  language-javascript">
      <span class="token comment" spellcheck="true">//captures '1-a_6' but not '543-azser-sder'
      </span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/[0-9]+-[[\\w]]*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">//captures '1-a_6' and '543-az(ser"-sder' but not '5-a s'
      </span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/[0-9]+-[[\\S]]*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">//captures all (equivalent to '.*')
      </span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'[[\\s\\S]]*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            </div>

        </section>

        <section>
            <h3 id="app.path">

                app.path（）

            </h3>

            <p>

                返回应用程序的规范路径，一个字符串。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">,</span> blog <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">,</span> blogAdmin <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/blog'</span><span class="token punctuation">,</span> blog<span class="token punctuation">)</span><span class="token punctuation">;</span>
      blog<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/admin'</span><span class="token punctuation">,</span> blogAdmin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>app<span class="token punctuation">.</span><span class="token function">path<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ''
      </span>console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>blog<span class="token punctuation">.</span><span class="token function">path<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// '/blog'
      </span>console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>blogAdmin<span class="token punctuation">.</span><span class="token function">path<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// '/blog/admin'
      </span></code></pre>

            <p>

                在安装应用程序的复杂情况下，此方法的行为会变得非常复杂：通常最好使用
                <a href="#req.baseUrl" class="active">

                    req.baseUrl

                </a>

                来获取应用程序的规范路径。

            </p>

        </section>

        <section>
            <h3 id="app.post.method">

                app.post（path，callback [，callback ...]）

            </h3>

            <p>

                使用指定的回调函数将HTTP POST请求路由到指定的路径。
                有关更多信息，请参阅
                <a href="/guide/routing.html">

                    路由指南

                </a>

                。

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <h4 id="example-2">

                例

            </h4>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">post<span class="token punctuation">(</span></span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'POST request to homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.put.method">

                app.put（path，callback [，callback ...]）

            </h3>

            <p>

                使用指定的回调函数将HTTP PUT请求路由到指定的路径。

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <h4 id="example-3">

                例

            </h4>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">put<span class="token punctuation">(</span></span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'PUT request to homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.render">

                app.render（查看，[本地人]，回调）

            </h3>

            <p>

                通过
                <code>callback</code>

                函数
                返回视图的呈现HTML
                。
                它接受一个可选参数，该参数是包含视图局部变量的对象。
                它就像
                <a href="#res.render" class="active">

                    res.render（）

                </a>

                ，除了它<a href="#res.render" class="active">
                    不能自己
                </a>
                将渲染的视图发送到客户端。

            </p>

            <div class="doc-box doc-info">
                <p>

                    可以将其
                    <code>app.render()</code>

                    视为用于生成渲染视图字符串的实用函数。
                    内部
                    <code>res.render()</code>

                    用于
                    <code>app.render()</code>

                    渲染视图。

                </p>
            </div>

            <div class="doc-box doc-notice">
                <p>
                    <code>cache</code>

                    保留
                    局部变量
                    以启用视图缓存。
                    <code>true</code>

                    如果要在开发期间缓存视图，请将
                    其设置为
                    ;
                    默认情况下，生产中启用了视图缓存。

                </p>
            </div>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">render<span class="token punctuation">(</span></span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">render<span class="token punctuation">(</span></span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.route">

                app.route（路径）

            </h3>

            <p>

                返回单个路由的实例，然后您可以使用该实例处理带有可选中间件的HTTP谓词。
                使用
                <code>app.route()</code>

                以避免重复路线名称（因此错字错误）。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">route<span class="token punctuation">(</span></span><span class="token string">'/events'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// runs for all HTTP verbs first
      </span>  <span class="token comment" spellcheck="true">// think of it as route specific middleware!
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// maybe add a new event...
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="app.set">

                app.set（名称，值）

            </h3>

            <p>

                将设置分配
                <code>name</code>

                给
                <code>value</code>

                。
                您可以存储所需的任何值，但可以使用某些名称来配置服务器的行为。
                这些特殊名称列在
                <a href="#app.settings.table">

                    应用程序设置表中

                </a>

                。

            </p>

            <p>

                调用
                <code>app.set('foo', true)</code>

                Boolean属性与调用相同

                <code>app.enable('foo')</code>

                。
                同样，调用
                <code>app.set('foo', false)</code>

                Boolean属性与调用相同
                <code>app.disable('foo')</code>

                。

            </p>

            <p>

                使用检索设置的值
                <a href="#app.get" class="active"><code>app.get()</code></a>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'My Site'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "My Site"
      </span></code></pre>

            <h4 id="app.settings.table">

                应用程序设置

            </h4>

            <p>

                下表列出了应用程序设置。

            </p>

            <p>

                请注意，子应用将：

            </p>

            <ul>
                <li>

                    不继承具有默认值的设置的值。
                    您必须在子应用程序中设置该值。

                </li>
                <li>

                    继承没有默认值的设置值;
                    这些都在下表中明确指出。

                </li>
            </ul>

            <p>

                例外：子应用程序将继承其值，
                <code>trust proxy</code>

                即使它具有默认值（为了向后兼容）;
                子应用程序不会继承
                <code>view cache</code>

                生产中
                的价值
                （何时
                <code>NODE_ENV</code>

                是“生产”）。

            </p>

            <div class="table-scroller">
                <table class="doctable">
                    <thead>
                        <tr>
                            <th id="app-settings-property">

                                属性

                            </th>
                            <th>

                                类型

                            </th>
                            <th>

                                描述

                            </th>
                            <th>

                                默认

                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <p><code>case sensitive routing</code></p>
                            </td>
                            <td>

                                布尔

                            </td>
                            <td>
                                <p>

                                    启用区分大小写。
                                    启用时，“/ Foo”和“/ foo”是不同的路由。
                                    禁用时，“/ Foo”和“/ foo”的处理方式相同。

                                </p>
                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序将继承此设置的值。

                                </p>
                            </td>
                            <td>

                                N / A（未定义）


                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>env</code></p>
                            </td>
                            <td>

                                串

                            </td>
                            <td>

                                环境模式。
                                务必在生产环境中设置为“生产”;
                                请参阅
                                <a href="/advanced/best-practice-performance.html#env">

                                    生产最佳实践：性能和可靠性

                                </a>

                                。


                            </td>
                            <td>
                                <p><code>process.env.NODE_ENV</code>

                                    （
                                    <code>NODE_ENV</code>

                                    环境变量）或“开发”如果
                                    <code>NODE_ENV</code>

                                    没有设置。

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>etag</code></p>
                            </td>
                            <td>

                                多变

                            </td>
                            <td>
                                <p>

                                    设置ETag响应头。
                                    有关可能的值，请参阅
                                    <a href="#etag.options.table"><code>etag</code>

                                        选项表
                                    </a>

                                    。

                                </p>

                                <p><a href="http://en.wikipedia.org/wiki/HTTP_ETag">

                                        有关HTTP ETag标头的更多信息

                                    </a>

                                    。

                                </p>
                            </td>
                            <td>
                                <p><code>weak</code></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>jsonp callback name</code></p>
                            </td>
                            <td>

                                串

                            </td>
                            <td>

                                指定默认的JSONP回调名称。

                            </td>
                            <td>
                                <p>

                                    “打回来”

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>json escape</code></p>
                            </td>
                            <td>

                                布尔

                            </td>
                            <td>
                                <p>

                                    启用从逃逸JSON响应
                                    <code>res.json</code>

                                    ，
                                    <code>res.jsonp</code>

                                    以及
                                    <code>res.send</code>

                                    API的。
                                    这将转义字符
                                    <code>&lt;</code>

                                    ，
                                    <code>&gt;</code>

                                    并
                                    <code>&amp;</code>

                                    作为JSON中的Unicode转义序列。
                                    当客户端嗅探HTML响应时
                                    ，它的目的是帮助
                                    <a
                                        href="https://blog.mozilla.org/security/2017/07/18/web-service-audits-firefox-accounts/">

                                        减轻某些类型的持久性XSS攻击

                                    </a>

                                    。

                                </p>
                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序将继承此设置的值。

                                </p>
                            </td>
                            <td>

                                N / A（未定义）

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>json replacer</code></p>
                            </td>
                            <td>

                                多变

                            </td>
                            <td>
                                <a
                                    href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_replacer_parameter">

                                    `JSON.stringify`使用

                                </a>

                                的<a
                                    href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_replacer_parameter">
                                    'replacer'参数
                                </a>
                                。


                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序将继承此设置的值。

                                </p>
                            </td>
                            <td>

                                N / A（未定义）


                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>json spaces</code></p>
                            </td>
                            <td>

                                多变

                            </td>
                            <td>
                                <a
                                    href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument">

                                    `JSON.stringify`使用

                                </a>

                                的<a
                                    href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument">
                                    'space'参数
                                </a>
                                。
                                这通常设置为用于缩进美化JSON的空格数。


                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序将继承此设置的值。

                                </p>
                            </td>
                            <td>

                                N / A（未定义）

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>query parser</code></p>
                            </td>
                            <td>

                                多变

                            </td>
                            <td>
                                <p>

                                    通过将值设置为禁用查询解析
                                    <code>false</code>

                                    ，或将查询解析器设置为使用“简单”或“扩展”或自定义查询字符串解析函数。


                                </p>

                                <p>

                                    简单的查询解析器基于Node的本机查询解析器
                                    <a href="http://nodejs.org/api/querystring.html">

                                        querystring

                                    </a>

                                    。

                                </p>

                                <p>

                                    扩展查询解析器基于
                                    <a href="https://www.npmjs.org/package/qs">

                                        qs

                                    </a>

                                    。

                                </p>

                                <p>

                                    自定义查询字符串解析函数将接收完整的查询字符串，并且必须返回查询键及其值的对象。


                                </p>
                            </td>
                            <td>

                                “扩展”

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>strict routing</code></p>
                            </td>
                            <td>

                                布尔

                            </td>
                            <td>
                                <p>

                                    启用严格路由。
                                    启用后，路由器将“/ foo”和“/ foo /”视为不同。
                                    否则，路由器将“/ foo”和“/ foo /”视为相同。

                                </p>
                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序将继承此设置的值。

                                </p>
                            </td>
                            <td>

                                N / A（未定义）

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>subdomain offset</code></p>
                            </td>
                            <td>

                                数

                            </td>
                            <td>

                                要删除以访问子域的主机的点分隔部分的数量。

                            </td>
                            <td>

                                2

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>trust proxy</code></p>
                            </td>
                            <td>

                                多变

                            </td>
                            <td>
                                <p>

                                    表示应用程序位于前置代理后面，并使用
                                    <code>X-Forwarded-*</code>

                                    标头确定客户端的连接和IP地址。
                                    注意：
                                    <code>X-Forwarded-*</code>

                                    标头很容易被欺骗，检测到的IP地址不可靠。

                                </p>
                                <p>


                                    启用后，Express会尝试确定通过前端代理或一系列代理连接的客户端的IP地址。
                                    然后，`req.ips`属性包含客户端通过的IP地址数组。
                                    要启用它，请使用
                                    <a href="#trust.proxy.options.table">

                                        信任代理选项表中

                                    </a>

                                    描述的值
                                    。


                                </p>
                                <p>


                                    `trust proxy`设置是使用
                                    <a href="https://www.npmjs.org/package/proxy-addr">

                                        proxy-addr

                                    </a>

                                    包实现的。
                                    有关更多信息，请参阅其文档。


                                </p>
                                <p>
                                    <b>

                                        注意

                                    </b>

                                    ：子应用程序
                                    <i>

                                        将

                                    </i>

                                    继承此设置的值，即使它具有默认值。


                                </p>
                            </td>
                            <td>
                                <p><code>false</code>

                                    （禁用）

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>views</code></p>
                            </td>
                            <td>

                                字符串或数组

                            </td>
                            <td>

                                应用程序视图的目录或目录数组。
                                如果是数组，则按照它们在数组中出现的顺序查找视图。

                            </td>
                            <td>
                                <p><code>process.cwd() + '/views'</code></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>view cache</code></p>
                            </td>
                            <td>

                                布尔

                            </td>
                            <td>
                                <p>

                                    启用视图模板编译缓存。

                                </p>
                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序不会在生产中继承此设置的值（当“NODE_ENV”为“生产”时）。


                                </p>
                            </td>
                            <td>
                                <p><code>true</code>

                                    在生产中，否则未定义。

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>view engine</code></p>
                            </td>
                            <td>

                                串

                            </td>
                            <td>

                                省略时使用的默认引擎扩展。


                                <p><b>

                                        注意

                                    </b>

                                    ：子应用程序将继承此设置的值。

                                </p>
                            </td>
                            <td>

                                N / A（未定义）

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><code>x-powered-by</code></p>
                            </td>
                            <td>

                                布尔

                            </td>
                            <td>

                                启用“X-Powered-By：Express”HTTP标头。

                            </td>
                            <td>
                                <p><code>true</code></p>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h5 id="trust.proxy.options.table">

                    “信任代理”设置的选项

                </h5>

                <p>


                    阅读
                    <a href="/guide/behind-proxies.html">

                        代理后面的Express

                    </a>

                    以获取更多信息。


                </p>

                <table class="doctable">
                    <thead>
                        <tr>
                            <th>

                                类型

                            </th>
                            <th>

                                值

                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>

                                布尔

                            </td>
                            <td>
                                <p>

                                    如果
                                    <code>true</code>

                                    ，客户端的IP地址被理解为
                                    <code>X-Forwarded-*</code>

                                    标题中
                                    最左边的条目
                                    。

                                </p>

                                <p>

                                    如果
                                    <code>false</code>

                                    ，该应用程序被理解为直接面向Internet，并且客户端的IP地址来自

                                    <code>req.connection.remoteAddress</code>

                                    。
                                    这是默认设置。

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>

                                String
                                <br>

                                包含逗号分隔值
                                <br>

                                的字符串字符串数组

                            </td>
                            <td>
                                <p>

                                    IP地址，子网或IP地址数组以及要信任的子网。
                                    预配置的子网名称为：

                                </p>

                                <ul>
                                    <li>

                                        环回 -
                                        <code>127.0.0.1/8</code>

                                        ，
                                        <code>::1/128</code>
                                    </li>
                                    <li>

                                        linklocal -
                                        <code>169.254.0.0/16</code>

                                        ，
                                        <code>fe80::/10</code>
                                    </li>
                                    <li>

                                        uniquelocal - ，
                                        <code>10.0.0.0/8</code>

                                        ，
                                        ，
                                        <code>172.16.0.0/12</code>
                                        <code>192.168.0.0/16</code>
                                        <code>fc00::/7</code>
                                    </li>
                                </ul>

                                <p>

                                    通过以下任一方式设置IP地址：

                                </p>

                                <p>

                                    指定单个子网：

                                </p>

                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback'</span><span class="token punctuation">)</span> 
      </code></pre>

                                <p>

                                    指定子网和地址：

                                </p>

                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback, 123.123.123.123'</span><span class="token punctuation">)</span> 
      </code></pre>

                                <p>

                                    将多个子网指定为CSV：

                                </p>

                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback, linklocal, uniquelocal'</span><span class="token punctuation">)</span> 
      </code></pre>

                                <p>

                                    将多个子网指定为数组：

                                </p>

                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'loopback'</span><span class="token punctuation">,</span> <span class="token string">'linklocal'</span><span class="token punctuation">,</span> <span class="token string">'uniquelocal'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      </code></pre>

                                <p>


                                    指定时，IP地址或子网将从地址确定过程中排除，并且最靠近应用程序服务器的不受信任的IP地址将被确定为客户端的IP地址。

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>

                                数

                            </td>
                            <td>
                                <p>

                                    信任
                                    来自前置代理服务器的<sup>
                                        第
                                    </sup>
                                    <i>

                                        n

                                    </i>

                                    跳作为客户端。
                                    <sup>

                                    </sup>

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>

                                函数

                            </td>
                            <td>
                                <p>

                                    定制信任实施。
                                    只有在你知道自己在做什么的情况下才能使用它。

                                </p>

                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ip <span class="token operator">===</span> <span class="token string">'127.0.0.1'</span> <span class="token operator">||</span> ip <span class="token operator">===</span> <span class="token string">'123.123.123.123'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// trusted IPs
      </span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h5 id="etag.options.table">

                    “etag”设置的选项

                </h5>

                <p>
                    <strong>

                        注意

                    </strong>

                    ：这些设置仅适用于动态文件，而不适用于静态文件。
                    该
                    <a href="#express.static" class="active">

                        express.static

                    </a>

                    中间件忽略这些设置。


                </p>

                <p>


                    ETag函数使用

                    <a href="https://www.npmjs.org/package/etag">

                        etag

                    </a>

                    包实现。
                    有关更多信息，请参阅其文档。


                </p>

                <table class="doctable">
                    <thead>
                        <tr>
                            <th>

                                类型

                            </th>
                            <th>

                                值

                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>

                                布尔

                            </td>
                            <td>
                                <p><code>true</code>

                                    使弱ETag。
                                    这是默认设置。
                                    <br>
                                    <code>false</code>

                                    完全禁用ETag。

                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>

                                串

                            </td>
                            <td>


                                如果“强大”，则启用强大的ETag。
                                <br>


                                如果“弱”，则启用弱ETag。


                            </td>
                        </tr>
                        <tr>
                            <td>

                                函数

                            </td>
                            <td>
                                <p>

                                    自定义ETag函数实现。
                                    只有在你知道自己在做什么的情况下才能使用它。

                                </p>

                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'etag'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>body<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">generateHash<span class="token punctuation">(</span></span>body<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// consider the function is defined
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </section>

        <section>
            <h3 id="app.use">

                app.use（[path，] callback [，callback ...]）

            </h3>

            <p>

                在指定的路径上
                安装指定的
                <a href="/guide/using-middleware.html">

                    中间件

                </a>

                函数：当请求的路径的基数匹配时，执行中间件函数
                <code>path</code>

                。

            </p>

            <h4>

                参数

            </h4>

            <table class="doctable">
                <tbody>
                    <tr>
                        <th>

                            争论

                        </th>
                        <th>

                            描述

                        </th>
                        <th style="width: 100px;">

                            默认

                        </th>
                    </tr>

                    <tr>
                        <td><code>path</code></td>
                        <td>


                            调用中间件函数的路径;
                            可以是以下任何一种：


                            <ul>
                                <li>

                                    表示路径的字符串。

                                </li>
                                <li>

                                    路径模式。

                                </li>
                                <li>

                                    用于匹配路径的正则表达式模式。

                                </li>
                                <li>

                                    任何上述组合的阵列。

                                </li>
                            </ul>



                            有关示例，请参阅
                            <a href="#path-examples">

                                路径示例

                            </a>

                            。


                        </td>
                        <td>

                            '/'（根路径）

                        </td>
                    </tr>

                    <tr>
                        <td> <code>callback</code></td>
                        <td>


                            回调函数;
                            可：


                            <ul>
                                <li>

                                    中间件函数。

                                </li>
                                <li>

                                    一系列中间件函数（以逗号分隔）。

                                </li>
                                <li>

                                    一系列中间件函数。

                                </li>
                                <li>

                                    以上所有的组合。

                                </li>
                            </ul>
                            <p>


                                您可以提供多个类似中间件的回调函数，除了这些回调可以调用
                                <code>next('route')</code>

                                以绕过剩余的路由回调。

                                您可以使用此机制对路径施加前置条件，然后在没有理由继续当前路由的情况下将控制权传递给后续路由。


                            </p>
                            <p>


                                由于
                                <a href="#router" class="active">

                                    路由器

                                </a>

                                和
                                <a href="#application">

                                    应用程序

                                </a>

                                实现了中间件接口，您可以像使用任何其他中间件函数一样使用它们。


                            </p>
                            <p>


                                有关示例，请参阅
                                <a href="#middleware-callback-function-examples">

                                    中间件回调函数示例

                                </a>

                                。


                            </p>
                        </td>
                        <td>

                            没有

                        </td>
                    </tr>
                </tbody>
            </table>

            <h4 id="description">

                描述

            </h4>

            <p>

                路径将立即匹配其路径后面的任何路径“
                <code>/</code>

                ”。
                例如：
                <code>app.use('/apple', ...)</code>

                将匹配“/ apple”，“/ apple / images”，“/ apple / images / news”等。


            </p>

            <p>

                由于
                <code>path</code>

                默认为“/”，因此对应用程序的每个请求都将执行没有路径安装的中间件。
                <br>


                例如，
                对应用程序的
                <em>

                    每个

                </em>

                请求
                都将执行此中间件函数
                ：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'Time: %d'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <div class="doc-box doc-info">
                <p><strong>

                        注意

                    </strong></p>

                <p>

                    子应用程序将：

                </p>

                <ul>
                    <li>

                        不继承具有默认值的设置的值。
                        您必须在子应用程序中设置该值。

                    </li>
                    <li>

                        继承没有默认值的设置值。

                    </li>
                </ul>

                <p>

                    有关详细信息，请参阅
                    <a href="/en/4x/api.html#app.settings.table">

                        应用程序设置

                    </a>

                    。

                </p>
            </div>

            <p>

                中间件函数是顺序执行的，因此中间件包含的顺序很重要。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// this middleware will not allow the request to go beyond it
      </span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// requests will never reach this route
      </span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Welcome'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p><strong>

                    错误处理中间件

                </strong></p>

            <p>

                错误处理中间件总是需要
                <em>

                    四个

                </em>

                参数。
                您必须提供四个参数以将其标识为错误处理中间件函数。
                即使您不需要使用该
                <code>next</code>

                对象，也必须指定它以维护签名。
                否则，该
                <code>next</code>

                对象将被解释为常规中间件，并且将无法处理错误。
                有关错误处理中间件的详细信息，请参阅：
                <a href="/en/guide/error-handling.html">

                    错误处理

                </a>

                。

            </p>

            <p>

                以与其他中间件函数相同的方式定义错误处理中间件函数，除了四个参数而不是三个，特别是签名
                <code>(err, req, res, next)</code>

                ）：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error<span class="token punctuation">(</span></span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Something broke!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <h4 id="path-examples">

                路径示例

            </h4>

            <p>

                下表提供了一些
                <code>path</code>

                用于安装中间件
                的有效值的简单示例
                。

            </p>

            <div class="table-scroller">
                <table class="doctable">

                    <thead>
                        <tr>
                            <th>

                                类型

                            </th>
                            <th>

                                例

                            </th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr>
                            <td>

                                路径

                            </td>
                            <td>


                                这将匹配以`/ abcd`开头的路径：


                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/abcd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                            </td>
                        </tr>

                        <tr>
                            <td>

                                路径模式

                            </td>
                            <td>


                                这将匹配以`/ abcd`和`/ abd`开头的路径：


                                <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/abc?d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>



                                这将匹配以`/ abcd`，`/ abbcd`，`/ abbbbbcd`开头的路径，依此类推：


                                <pre
                                    class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/ab+cd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



                                这将匹配以`/ abcd`，`/ abxcd`，`/ abFOOcd`，`/ abbArcd`开头的路径，依此类推：


                                <pre
                                    class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/ab\*cd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



                                这将匹配以`/ ad`和`/ abcd`开头的路径：


                                <pre
                                    class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/a(bc)?d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                            </td>
                        </tr>

                        <tr>
                            <td>

                                正则表达式

                            </td>
                            <td>


                                这将匹配以`/ abc`和`/ xyz`开头的路径：


                                <pre
                                    class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token regex">/\/abc|\/xyz/</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                            </td>
                        </tr>

                        <tr>
                            <td>

                                排列

                            </td>
                            <td>


                                这将匹配以`/ abcd`，`/ xyza`，`/ lmn`和`/ pqr`开头的路径：


                                <pre
                                    class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'/abcd'</span><span class="token punctuation">,</span> <span class="token string">'/xyza'</span><span class="token punctuation">,</span> <span class="token operator">/</span>\<span class="token operator">/</span>lmn<span class="token operator">|</span>\<span class="token operator">/</span>pqr<span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                            </td>
                        </tr>

                    </tbody>

                </table>
            </div>

            <h4 id="middleware-callback-function-examples">

                中间件回调函数示例

            </h4>

            <p>

                下表提供了可被用作的中间件函数一些简单的例子
                <code>callback</code>

                参数
                <code>app.use()</code>

                ，
                <code>app.METHOD()</code>

                和
                <code>app.all()</code>

                。
                尽管例子是
                <code>app.use()</code>

                ，它们也适用于
                <code>app.use()</code>

                ，
                <code>app.METHOD()</code>

                和
                <code>app.all()</code>

                。

            </p>

            <table class="doctable">

                <thead>
                    <tr>
                        <th>

                            用法

                        </th>
                        <th>

                            例

                        </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <td>

                            单个中间件

                        </td>
                        <td>

                            您可以在本地定义和安装中间件函数。


                            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>


                            路由器是有效的中间件。



                            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>



                            Express应用程序是有效的中间件。


                            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> subApp <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      subApp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>subApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                        </td>
                    </tr>

                    <tr>
                        <td>

                            中间件系列

                        </td>
                        <td>


                            您可以在同一装载路径中指定多个中间件函数。


                            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                        </td>
                    </tr>

                    <tr>
                        <td>

                            排列

                        </td>
                        <td>


                            使用数组逻辑分组中间件。
                            如果将中间件数组作为第一个或仅中间件参数传递，则
                            <em>

                                必须

                            </em>

                            指定安装路径。


                            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                        </td>
                    </tr>

                    <tr>
                        <td>

                            组合

                        </td>
                        <td>


                            您可以结合上述所有安装中间件的方法。


                            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">function</span> <span class="token function">mw1<span class="token punctuation">(</span></span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">function</span> <span class="token function">mw2<span class="token punctuation">(</span></span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      
      <span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">var</span> subApp <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      subApp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>mw1<span class="token punctuation">,</span> <span class="token punctuation">[</span>mw2<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">]</span><span class="token punctuation">,</span> subApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
                        </td>
                    </tr>

                </tbody>

            </table>

            <p>

                以下是

                在Express应用程序
                中使用
                <a href="/guide/using-middleware.html#middleware.built-in">

                    express.static

                </a>

                中间件的
                一些示例
                。

            </p>

            <p>

                从应用程序目录中的“public”目录为应用程序提供静态内容：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// GET /style.css etc
      </span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                将中间件安装在“/ static”以仅在其请求路径以“/ static”为前缀时才提供静态内容：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// GET /static/style.css etc.
      </span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/static'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                通过在静态中间件之后加载记录器中间件来禁用静态内容请求的日志记录：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token function">logger<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                提供来自多个目录的静态文件，但优先于“./public”而不是其他目录：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <h2 id="req">

            请求

        </h2>

        <p>

            该
            <code>req</code>

            对象表示HTTP请求，并具有请求查询字符串，参数，正文，HTTP标头等的属性。
            在本文档中，按照惯例，对象始终称为
            <code>req</code>

            （并且HTTP响应为
            <code>res</code>

            ），但其实际名称由您正在使用的回调函数的参数确定。

        </p>

        <p>

            例如：

        </p>

        <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'user '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        <p>

            但你也可以这样做：

        </p>

        <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'user '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        <p>

            该
            <code>req</code>

            对象是Node自己的请求对象的增强版本，并支持所有
            <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage">

                内置字段和方法

            </a>

            。

        </p>

        <h3 id="req.properties">

            属性

        </h3>

        <div class="doc-box doc-notice">
            <p>

                在Express 4中，
                默认情况下
                <code>req.files</code>

                在
                <code>req</code>

                对象
                上不再可用
                。
                要访问上载文件
                <code>req.files</code>

                对象，使用像多处理中间件
                <a href="https://www.npmjs.
      com/package/busboy">

                    打杂

                </a>

                ，
                <a href="https://www.npmjs.com/package/multer">

                    multer

                </a>

                ，

                <a href="https://www.npmjs.com/package/formidable">

                    强大

                </a>

                ，

                <a href="https://www.npmjs.com/package/multiparty">

                    多方

                </a>

                ，

                <a href="https://www.npmjs.com/package/connect-multiparty">

                    连接多党

                </a>

                或
                <a href="https://www.npmjs.com/package/pez">

                    佩斯

                </a>

                。

            </p>
        </div>

        <section>
            <h3 id="req.app">

                req.app

            </h3>

            <p>

                此属性包含对使用中间件的Express应用程序实例的引用。

            </p>

            <p>

                如果您遵循创建模块的模式，该模块只是
                <code>require()</code>

                在主文件中
                导出中间件函数
                ，那么中间件可以通过以下方式访问Express实例
                <code>req.app</code>
            </p>

            <p>

                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">//index.js
      </span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/viewdirectory'</span><span class="token punctuation">,</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'./mymiddleware.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      </code></pre>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">//mymiddleware.js
      </span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'The views directory is '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="req.baseUrl">

                req.baseUrl

            </h3>

            <p>

                安装路由器实例的URL路径。

            </p>

            <p>

                该
                <code>req.baseUrl</code>

                属性类似于
                对象
                的
                <a href="#app.mountpath" class="active">

                    mountpath

                </a>

                属性
                <code>app</code>

                ，除了
                <code>app.mountpath</code>

                返回匹配的路径模式。

            </p>

            <p>

                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> greet <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      greet<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/jp'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /greet
      </span>  res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Konichiwa!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/greet'</span><span class="token punctuation">,</span> greet<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// load the router on '/greet'
      </span></code></pre>

            <p>

                即使您使用路径模式或一组路径模式来加载路由器，该
                <code>baseUrl</code>

                属性
                也会
                返回匹配的字符串，而不是模式。
                在以下示例中，
                <code>greet</code>

                路由器加载了两种路径模式。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'/gre+t'</span><span class="token punctuation">,</span> <span class="token string">'/hel{2}o'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> greet<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// load the router on '/gre+t' and '/hel{2}o'
      </span></code></pre>

            <p>

                当发出请求时
                <code>/greet/jp</code>

                ，
                <code>req.baseUrl</code>

                是“/ greet”。
                当发出请求时
                <code>/hello/jp</code>

                ，
                <code>req.baseUrl</code>

                是“/ hello”。

            </p>

        </section>

        <section>
            <h3 id="req.body">

                req.body

            </h3>

            <p>

                包含请求正文中提交的键值对数据。
                默认情况下，
                <code>undefined</code>

                当您使用正文
                <a href="https://www.npmjs.org/package/body-parser">

                    解析器

                </a>

                和
                <a href="https://www.npmjs.org/package/multer">

                    multer

                </a>

                等<a href="https://www.npmjs.org/package/body-parser">
                    正文
                </a>
                解析中间件时
                ，它会
                被填充
                。

            </p>

            <p>

                以下示例显示如何使用正文解析中间件进行填充
                <code>req.body</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> multer <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// v1.0.5
      </span><span class="token keyword">var</span> upload <span class="token operator">=</span> <span class="token function">multer<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// for parsing multipart/form-data
      </span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>bodyParser<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// for parsing application/json
      </span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded<span class="token punctuation">(</span></span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// for parsing application/x-www-form-urlencoded
      </span>
      app<span class="token punctuation">.</span><span class="token function">post<span class="token punctuation">(</span></span><span class="token string">'/profile'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">array<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="req.cookies">

                req.cookies

            </h3>

            <p>

                使用
                <a href="https://www.npmjs.com/package/cookie-parser">

                    cookie-parser

                </a>

                中间件时，此属性是包含请求发送的cookie的对象。
                如果请求不包含cookie，则默认为
                <code>{}</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// Cookie: name=tj
      </span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>name
      <span class="token comment" spellcheck="true">// =&gt; "tj"
      </span></code></pre>

            <p>

                如果cookie已签名，则必须使用
                <a href="#req.signedCookies" class="active">

                    req.signedCookies

                </a>

                。

            </p>

            <p>

                有关更多信息，问题或疑虑，请参阅
                <a href="https://github.com/expressjs/cookie-parser">

                    cookie-parser

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.fresh">

                req.fresh

            </h3>

            <p>

                指示请求是否“新鲜”。它是相反的
                <code>req.stale</code>

                。

            </p>

            <p>

                如果
                <code>cache-control</code>

                请求标头没有
                <code>no-cache</code>

                指令并且满足以下任何条件，
                则为
                true：

            </p>

            <ul>
                <li>

                    的
                    <code>if-modified-since</code>

                    请求报头中指定和
                    <code>last-modified</code>

                    请求头是等于或早于
                    <code>modified</code>

                    响应头。

                </li>
                <li>

                    的
                    <code>if-none-match</code>

                    请求头是
                    <code>*</code>

                    。

                </li>
                <li>
                    <code>if-none-match</code>

                    解析为其指令后
                    ，
                    请求标头与
                    <code>etag</code>

                    响应标头
                    不匹配
                    。

                </li>
            </ul>

            <pre class="  language-javascript"><code class="  language-javascript">req<span class="token punctuation">.</span>fresh
      <span class="token comment" spellcheck="true">// =&gt; true
      </span></code></pre>

            <p>

                欲了解更多信息，问题或疑虑，看
                <a href="https://github.com/jshttp/fresh">

                    新鲜

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.hostname">

                req.hostname

            </h3>

            <p>

                包含从
                <code>Host</code>

                HTTP标头
                派生的主机名
                。

            </p>

            <p>

                如果
                <a href="/4x/api.html#trust.proxy.options.table"><code>trust proxy</code>

                    设置
                </a>

                未评估为
                <code>false</code>

                ，则此属性将具有
                <code>X-Forwarded-Host</code>

                标题字段
                的值
                。
                此标头可由客户端或代理设置。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// Host: "example.com:3000"
      </span>req<span class="token punctuation">.</span>hostname
      <span class="token comment" spellcheck="true">// =&gt; "example.com"
      </span></code></pre>

        </section>

        <section>
            <h3 id="req.ip">

                req.ip

            </h3>

            <p>

                包含请求的远程IP地址。

            </p>

            <p>

                如果
                <a href="/4x/api.html#trust.proxy.options.table"><code>trust proxy</code>

                    设置
                </a>

                未评估为
                <code>false</code>

                ，则此属性的值派生自
                <code>X-Forwarded-For</code>

                标头中
                最左侧的条目

                。
                此标头可由客户端或代理设置。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">req<span class="token punctuation">.</span>ip
      <span class="token comment" spellcheck="true">// =&gt; "127.0.0.1"
      </span></code></pre>

        </section>

        <section>
            <h3 id="req.ips">

                req.ips

            </h3>

            <p>

                如果
                <a href="/4x/api.html#trust.proxy.options.table"><code>trust proxy</code>

                    设置
                </a>

                未评估为
                <code>false</code>

                ，则此属性包含
                <code>X-Forwarded-For</code>

                请求标头中
                指定的IP地址数组
                。
                否则，它包含一个空数组。
                此标头可由客户端或代理设置。

            </p>

            <p>

                例如，如果
                <code>X-Forwarded-For</code>

                是
                <code>client, proxy1, proxy2</code>

                ，
                <code>req.ips</code>

                那么

                <code>["client", "proxy1", "proxy2"]</code>

                ，
                <code>proxy2</code>

                下游最远的地方。

            </p>

        </section>

        <section>
            <h3 id="req.method">

                req.method

            </h3>

            <p>

                包含对应于该请求的HTTP方法的字符串：

                <code>GET</code>

                ，
                <code>POST</code>

                ，
                <code>PUT</code>

                ，等。

            </p>

        </section>

        <section>
            <h3 id="req.originalUrl">

                req.originalUrl

            </h3>

            <div class="doc-box doc-notice">
                <p><code>req.url</code>

                    它不是本机Express属性，它继承自Node的
                    <a href="https://nodejs.org/api/http.html#http_message_url">

                        http模块

                    </a>

                    。

                </p>
            </div>

            <p>

                这个属性很像
                <code>req.url</code>

                ;
                但是，它保留了原始请求URL，允许您
                <code>req.url</code>

                自由
                重写
                以进行内部路由。
                例如，
                <a href="#app.use" class="active">

                    app.use（）

                </a>

                的“安装”函数
                将重写
                <code>req.url</code>

                以剥离挂载点。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// GET /search?q=something
      </span>req<span class="token punctuation">.</span>originalUrl
      <span class="token comment" spellcheck="true">// =&gt; "/search?q=something"
      </span></code></pre>

            <p>

                在中间件函数，
                <code>req.originalUrl</code>

                是的组合
                <code>req.baseUrl</code>

                和
                <code>req.path</code>

                ，作为显示在下面的例子。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/admin'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// GET 'http://www.example.com/admin/new'
      </span>  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>originalUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// '/admin/new'
      </span>  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// '/admin'
      </span>  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// '/new'
      </span>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="req.params">

                req.params

            </h3>

            <p>

                此属性是一个对象，包含映射到
                <a href="/en/guide/routing.html#route-parameters">

                    命名路由“parameters”的

                </a>

                属性
                。
                例如，如果您有路线
                <code>/user/:name</code>

                ，则“name”属性可用作
                <code>req.params.name</code>

                。
                该对象默认为
                <code>{}</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// GET /user/tj
      </span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name
      <span class="token comment" spellcheck="true">// =&gt; "tj"
      </span></code></pre>

            <p>

                当使用正则表达式的路由定义，使用阵列中提供了捕获基团
                <code>req.params[n]</code>

                ，其中，
                <code>n</code>

                为第n
                <sup>

                    个

                </sup>

                捕获组。
                此规则适用于带有字符串路由的未命名外卡匹配，例如
                <code>/file/*</code>

                ：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// GET /file/javascripts/jquery.js
      </span>req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token comment" spellcheck="true">// =&gt; "javascripts/jquery.js"
      </span></code></pre>

            <p>

                如果需要更改密钥
                <code>req.params</code>

                ，请使用
                <a href="/en/4x/api.html#app.param">

                    app.param

                </a>

                处理程序。
                更改仅适用于
                已在路径路径中定义的
                <a href="/en/guide/routing.html#route-parameters">

                    参数

                </a>

                。

            </p>

            <p>
                <code>req.params</code>

                将重置对中间件或路由处理程序中
                的
                对象
                所做的任何更改
                。

            </p>

            <div class="doc-box doc-info">
                <p>

                    注意：Express会自动解码
                    <code>req.params</code>

                    （使用
                    <code>decodeURIComponent</code>

                    ）中
                    的值
                    。

                </p>
            </div>

        </section>

        <section>
            <h3 id="req.path">

                req.path

            </h3>

            <p>

                包含请求URL的路径部分。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// example.com/users?sort=desc
      </span>req<span class="token punctuation">.</span>path
      <span class="token comment" spellcheck="true">// =&gt; "/users"
      </span></code></pre>

            <div class="doc-box doc-info">
                <p>

                    从中间件调用时，挂载点不包含在中
                    <code>req.path</code>

                    。
                    有关
                    详细信息，
                    请参阅
                    <a href="/4x/api.html#app.use">

                        app.use（）

                    </a>

                    。

                </p>
            </div>

        </section>

        <section>
            <h3 id="req.protocol">

                req.protocol

            </h3>

            <p>

                包含请求协议字符串：
                <code>http</code>

                或者（对于TLS请求）
                <code>https</code>

                。

            </p>

            <p>

                如果
                <a href="/4x/api.html#trust.proxy.options.table"><code>trust proxy</code>

                    设置
                </a>

                未评估为
                <code>false</code>

                ，则此属性将使用
                <code>X-Forwarded-Proto</code>

                标头字段
                的值（
                如果存在）。
                此标头可由客户端或代理设置。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">req<span class="token punctuation">.</span>protocol
      <span class="token comment" spellcheck="true">// =&gt; "http"
      </span></code></pre>

        </section>

        <section>
            <h3 id="req.query">

                req.query

            </h3>

            <p>

                此属性是一个对象，包含路由中每个查询字符串参数的属性。
                如果没有查询字符串，则为空对象
                <code>{}</code>

                。

            </p>

            <div class="doc-box doc-warn">
                <p>

                    由于
                    <code>req.query</code>

                    形状基于用户控制的输入，因此该对象中的所有属性和值都是不可信的，应在信任之前进行验证。
                    例如，
                    <code>req.query.foo.toString()</code>

                    可能以多种方式失败，例如
                    <code>foo</code>

                    可能不存在或者可能不是字符串，并且
                    <code>toString</code>

                    可能不是函数而是字符串或其他用户输入。

                </p>
            </div>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// GET /search?q=tobi+ferret
      </span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>q
      <span class="token comment" spellcheck="true">// =&gt; "tobi ferret"
      </span>
      <span class="token comment" spellcheck="true">// GET /shoes?order=desc&amp;shoe[color]=blue&amp;shoe[type]=converse
      </span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>order
      <span class="token comment" spellcheck="true">// =&gt; "desc"
      </span>
      req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>shoe<span class="token punctuation">.</span>color
      <span class="token comment" spellcheck="true">// =&gt; "blue"
      </span>
      req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>shoe<span class="token punctuation">.</span>type
      <span class="token comment" spellcheck="true">// =&gt; "converse"
      </span></code></pre>

        </section>

        <section>
            <h3 id="req.route">

                req.route

            </h3>

            <p>

                包含当前匹配的路由，一个字符串。
                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id?'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">userIdHandler<span class="token punctuation">(</span></span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                上一个代码段的示例输出：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/user/:id?'</span><span class="token punctuation">,</span>
        stack<span class="token punctuation">:</span>
         <span class="token punctuation">[</span> <span class="token punctuation">{</span> handle<span class="token punctuation">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">:</span> userIdHandler<span class="token punctuation">]</span><span class="token punctuation">,</span>
             name<span class="token punctuation">:</span> <span class="token string">'userIdHandler'</span><span class="token punctuation">,</span>
             params<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>
             path<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>
             keys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             regexp<span class="token punctuation">:</span> <span class="token regex">/^\/?$/i</span><span class="token punctuation">,</span>
             method<span class="token punctuation">:</span> <span class="token string">'get'</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        methods<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      </code></pre>

        </section>

        <section>
            <h3 id="req.secure">

                req.secure

            </h3>

            <p>

                一个布尔属性，如果建立了TLS连接，则该属性为true。
                相当于：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token string">'https'</span> <span class="token operator">==</span> req<span class="token punctuation">.</span>protocol<span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="req.signedCookies">

                req.signedCookies

            </h3>

            <p>

                使用
                <a href="https://www.npmjs.com/package/cookie-parser">

                    cookie-parser

                </a>

                中间件时，此属性包含请求发送的已签名cookie，未签名且可以使用。
                签名的cookie位于不同的对象中以显示开发者的意图;
                否则，可能会对
                <code>req.cookie</code>

                值（易于欺骗）
                进行恶意攻击

                。
                请注意，签署cookie不会使其“隐藏”或加密;
                但只是防止篡改（因为用于签名的秘密是私有的）。

            </p>

            <p>

                如果未发送已签名的cookie，则该属性默认为
                <code>{}</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// Cookie: user=tobi.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7/AcBBRVwlI3
      </span>req<span class="token punctuation">.</span>signedCookies<span class="token punctuation">.</span>user
      <span class="token comment" spellcheck="true">// =&gt; "tobi"
      </span></code></pre>

            <p>

                有关更多信息，问题或疑虑，请参阅
                <a href="https://github.com/expressjs/cookie-parser">

                    cookie-parser

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.stale">

                req.stale

            </h3>

            <p>

                指示请求是否“陈旧”，并且与之相反
                <code>req.fresh</code>

                。
                有关更多信息，请参阅
                <a href="#req.fresh" class="active">

                    req.fresh

                </a>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">req<span class="token punctuation">.</span>stale
      <span class="token comment" spellcheck="true">// =&gt; true
      </span></code></pre>

        </section>

        <section>
            <h3 id="req.subdomains">

                req.subdomains

            </h3>

            <p>

                请求的域名中的一组子域。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// Host: "tobi.ferrets.example.com"
      </span>req<span class="token punctuation">.</span>subdomains
      <span class="token comment" spellcheck="true">// =&gt; ["ferrets", "tobi"]
      </span></code></pre>

            <p>

                application属性
                <code>subdomain offset</code>

                （默认为2）用于确定子域段的开头。
                要更改此行为，请使用
                <a href="/en/4x/api.html#app.set">

                    app.set

                </a>

                更改其值
                。

            </p>

        </section>

        <section>
            <h3 id="req.xhr">

                req.xhr

            </h3>

            <p>

                一个布尔属性，
                <code>true</code>

                如果请求的
                <code>X-Requested-With</code>

                头字段是“XMLHttpRequest”，则表示该请求是由客户端库（如jQuery）发出的。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">req<span class="token punctuation">.</span>xhr
      <span class="token comment" spellcheck="true">// =&gt; true
      </span></code></pre>

        </section>

        <h3 id="req.methods">

            方法

        </h3>

        <section>
            <h3 id="req.accepts">

                req.accepts（类型）

            </h3>

            <p>

                根据请求的
                <code>Accept</code>

                HTTP头字段
                检查指定的内容类型是否可接受
                。
                该方法返回最佳匹配，或者如果没有指定的内容类型可接受，则返回

                <code>false</code>

                （在这种情况下，应用程序应响应
                <code>406 "Not Acceptable"</code>

                ）。

            </p>

            <p>

                该
                <code>type</code>

                值可以是单个MIME类型字符串（例如“application / json”），扩展名如“json”，逗号分隔列表或数组。

                对于列表或数组，该方法返回
                <em>

                    最佳

                </em>

                匹配（如果有）。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// Accept: text/html
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "html"
      </span>
      <span class="token comment" spellcheck="true">// Accept: text/*, application/json
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "html"
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "text/html"
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "json"
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "application/json"
      </span>
      <span class="token comment" spellcheck="true">// Accept: text/*, application/json
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token string">'png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; undefined
      </span>
      <span class="token comment" spellcheck="true">// Accept: text/*;q=.5, application/json
      </span>req<span class="token punctuation">.</span><span class="token function">accepts<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "json"
      </span></code></pre>

            <p>

                有关更多信息，或者您有任何问题或疑虑，请参阅
                <a href="https://github.com/expressjs/accepts">

                    接受

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.acceptsCharsets">

                req.acceptsCharsets（charset [，...]）

            </h3>

            <p>

                根据请求的
                <code>Accept-Charset</code>

                HTTP头字段
                返回指定字符集的第一个接受的字符集
                。
                如果未接受任何指定的字符集，则返回
                <code>false</code>

                。

            </p>

            <p>

                有关更多信息，或者您有任何问题或疑虑，请参阅
                <a href="https://github.com/expressjs/accepts">

                    接受

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.acceptsEncodings">

                req.acceptsEncodings（encoding [，...]）

            </h3>

            <p>

                根据请求的
                <code>Accept-Encoding</code>

                HTTP头字段
                ，返回指定编码的第一个接受编码
                。
                如果未接受任何指定的编码，则返回
                <code>false</code>

                。

            </p>

            <p>

                有关更多信息，或者您有任何问题或疑虑，请参阅
                <a href="https://github.com/expressjs/accepts">

                    接受

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.acceptsLanguages">

                req.acceptsLanguages（lang [，...]）

            </h3>

            <p>

                根据请求的
                <code>Accept-Language</code>

                HTTP头字段
                返回指定语言的第一个接受语言
                。
                如果未接受任何指定的语言，则返回
                <code>false</code>

                。

            </p>

            <p>

                有关更多信息，或者您有任何问题或疑虑，请参阅
                <a href="https://github.com/expressjs/accepts">

                    接受

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.get">

                req.get（场）

            </h3>

            <p>

                返回指定的HTTP请求标头字段（不区分大小写的匹配）。
                在
                <code>Referrer</code>

                和
                <code>Referer</code>

                领域是可以互换的。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">req<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "text/plain"
      </span>
      req<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "text/plain"
      </span>
      req<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'Something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; undefined
      </span></code></pre>

            <p>

                别名为
                <code>req.header(field)</code>

                。

            </p>

        </section>

        <section>
            <h3 id="req.is">

                req.is（类型）

            </h3>

            <p>

                如果传入请求的“Content-Type”HTTP标头字段与
                <code>type</code>

                参数
                指定的MIME类型匹配，则返回匹配的内容类型
                。
                如果请求没有正文，则返回
                <code>null</code>

                。
                <code>false</code>

                否则
                返回
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// With Content-Type: text/html; charset=utf-8
      </span>req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// =&gt; 'html'
      </span>req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// =&gt; 'text/html'
      </span>req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'text/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// =&gt; 'text/*'
      </span>
      <span class="token comment" spellcheck="true">// When Content-Type is application/json
      </span>req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// =&gt; 'json'
      </span>req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// =&gt; 'application/json'
      </span>req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'application/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// =&gt; 'application/*'
      </span>
      req<span class="token punctuation">.</span><span class="token function">is<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; false
      </span></code></pre>

            <p>

                有关更多信息，或者如果您有任何问题或疑虑，请参阅
                <a href="https://github.com/expressjs/type-is">

                    type-is

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="req.param">

                req.param（name [，defaultValue]）

            </h3>

            <div class="doc-box doc-warn">
                <p>

                    已过时。
                    二者必选其一
                    <code>req.params</code>

                    ，
                    <code>req.body</code>

                    或
                    <code>req.query</code>

                    （如适用）。

                </p>
            </div>

            <p>
                <code>name</code>

                当存在时
                返回param的值
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// ?name=tobi
      </span>req<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">)</span>
      <span class="token comment" spellcheck="true">// =&gt; "tobi"
      </span>
      <span class="token comment" spellcheck="true">// POST name=tobi
      </span>req<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">)</span>
      <span class="token comment" spellcheck="true">// =&gt; "tobi"
      </span>
      <span class="token comment" spellcheck="true">// /user/tobi for /user/:name
      </span>req<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">)</span>
      <span class="token comment" spellcheck="true">// =&gt; "tobi"
      </span></code></pre>

            <p>

                查找按以下顺序执行：

            </p>

            <ul>
                <li><code>req.params</code></li>
                <li><code>req.body</code></li>
                <li><code>req.query</code></li>
            </ul>

            <p>

                （可选）
                <code>defaultValue</code>

                如果在任何请求对象中找不到该参数，则
                可以指定
                设置默认值。

            </p>

            <div class="doc-box doc-warn">
                <p>

                    直接访问
                    <code>req.body</code>

                    ，
                    <code>req.params</code>

                    以及
                    <code>req.query</code>

                    应该赞成清晰-除非你真正接受来自每个对象的输入。

                </p>

                <p>

                    必须加载正文解析中间件才能
                    <code>req.param()</code>

                    以可预测的方式工作。
                    有关详细信息，
                    请参阅
                    <a href="#req.body" class="active">

                        req.body

                    </a>

                    。

                </p>
            </div>

        </section>

        <section>
            <h3 id="req.range">

                req.range（size [，options]）

            </h3>

            <p><code>Range</code>

                头解析器。

            </p>

            <p>

                该
                <code>size</code>

                参数是资源的最大尺寸。

            </p>

            <p>

                所述
                <code>options</code>

                参数是一个对象，可以具有以下性质。

            </p>

            <table>
                <thead>
                    <tr>
                        <th>

                            属性

                        </th>
                        <th>

                            类型

                        </th>
                        <th>

                            描述

                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>combine</code></td>
                        <td>

                            布尔

                        </td>
                        <td>

                            指定是否应组合重叠和相邻范围，默认为
                            <code>false</code>

                            。
                            何时
                            <code>true</code>

                            ，范围将被组合并返回，就好像它们在标题中指定了那样。

                        </td>
                    </tr>
                </tbody>
            </table>

            <p>

                将返回范围数组或指示错误解析的负数。

            </p>

            <ul>
                <li><code>-2</code>

                    表示格式错误的标题字符串

                </li>
                <li><code>-1</code>

                    表示不可满足的范围

                </li>
            </ul>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// parse header from request
      </span><span class="token keyword">var</span> range <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">range<span class="token punctuation">(</span></span><span class="token number">1000</span><span class="token punctuation">)</span>
      
      <span class="token comment" spellcheck="true">// the type of the range
      </span><span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'bytes'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// the ranges
      </span>  range<span class="token punctuation">.</span><span class="token function">forEach<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// do something with r.start and r.end
      </span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      </code></pre>

        </section>

        <h2 id="res">

            响应

        </h2>

        <p>

            该
            <code>res</code>

            对象表示Express应用程序在收到HTTP请求时发送的HTTP响应。

        </p>

        <p>

            在本文档中，按照惯例，对象始终称为
            <code>res</code>

            （并且HTTP请求是
            <code>req</code>

            ），但其实际名称由您正在使用的回调函数的参数确定。

        </p>

        <p>

            例如：

        </p>

        <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'user '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        <p>

            但你也可以这样做：

        </p>

        <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'user '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        <p>

            该
            <code>res</code>

            对象是Node自己的响应对象的增强版本，并支持所有
            <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse">

                内置字段和方法

            </a>

            。

        </p>

        <h3 id="res.properties">

            属性

        </h3>

        <section>
            <h3 id="res.app">

                res.app

            </h3>

            <p>

                此属性包含对使用中间件的Express应用程序实例的引用。

            </p>

            <p><code>res.app</code>

                与
                请求对象中
                的
                <a href="#req.app" class="active">

                    req.app

                </a>

                属性
                相同
                。

            </p>

        </section>

        <section>
            <h3 id="res.headersSent">

                res.headersSent

            </h3>

            <p>

                布尔属性，指示应用程序是否为响应发送了HTTP标头。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>res<span class="token punctuation">.</span>headersSent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false
      </span>  res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>res<span class="token punctuation">.</span>headersSent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.locals">

                res.locals

            </h3>

            <p>

                包含作用于请求的响应局部变量的对象，因此仅对在请求/响应周期（如果有）期间呈现的视图可用。
                否则，此属性与
                <a href="#app.locals" class="active">

                    app.locals

                </a>

                相同
                。

            </p>

            <p>

                此属性对于公开请求级别信息（例如请求路径名，经过身份验证的用户，用户设置等）非常有用。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>user <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>authenticated <span class="token operator">=</span> <span class="token operator">!</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>anonymous<span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <h3 id="res.methods">

            方法

        </h3>

        <section>
            <h3 id="res.append">

                res.append（field [，value]）

            </h3>

            <div class="doc-box doc-info">
                <p><code>res.append()</code>

                    Express v4.11.0 +支持

                </p>
            </div>

            <p>

                将指定的内容追加
                <code>value</code>

                到HTTP响应头
                <code>field</code>

                。
                如果尚未设置标头，则会创建具有指定值的标头。
                所述
                <code>value</code>

                参数可以是字符串或数组。

            </p>

            <p>

                注意：调用
                <code>res.set()</code>

                after
                <code>res.append()</code>

                将重置先前设置的标头值。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">append<span class="token punctuation">(</span></span><span class="token string">'Link'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'&lt;http://localhost/&gt;'</span><span class="token punctuation">,</span> <span class="token string">'&lt;http://localhost:3000/&gt;'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">append<span class="token punctuation">(</span></span><span class="token string">'Set-Cookie'</span><span class="token punctuation">,</span> <span class="token string">'foo=bar; Path=/; HttpOnly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">append<span class="token punctuation">(</span></span><span class="token string">'Warning'</span><span class="token punctuation">,</span> <span class="token string">'199 Miscellaneous warning'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.attachment">

                res.attachment（[filename]）

            </h3>

            <p>
                将HTTP响应头
                <code>Content-Disposition</code>字段设置为“attachment”。如果
                <code>filename</code>指定了路径，则它根据扩展名使用<code>res.type()</code>设置Content-Type，并设置
                <code>Content-Disposition</code>为“filename=”参数。
            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">attachment<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Content-Disposition: attachment
      </span>
      res<span class="token punctuation">.</span><span class="token function">attachment<span class="token punctuation">(</span></span><span class="token string">'path/to/logo.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Content-Disposition: attachment; filename="logo.png"
      </span><span class="token comment" spellcheck="true">// Content-Type: image/png
      </span></code></pre>

        </section>

        <section>
            <h3 id="res.cookie">

                res.cookie（名称，价值[，选项]）

            </h3>

            <p>

                将cookie设置
                <code>name</code>

                为
                <code>value</code>

                。
                所述
                <code>value</code>

                参数可以是转换为JSON字符串或对象。

            </p>

            <p>

                所述
                <code>options</code>

                参数是一个对象，可以具有以下性质。

            </p>

            <table>
                <thead>
                    <tr>
                        <th>

                            属性

                        </th>
                        <th>

                            类型

                        </th>
                        <th>

                            描述

                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>domain</code></td>
                        <td>String</td>
                        <td>

                            Cookie的域名。
                            默认为应用程序的域名。

                        </td>
                    </tr>
                    <tr>
                        <td><code>encode</code></td>
                        <td>Function</td>
                        <td>

                            用于cookie值编码的同步函数。
                            默认为
                            <code>encodeURIComponent</code>

                            。

                        </td>
                    </tr>
                    <tr>
                        <td><code>expires</code></td>
                        <td>Date</td>
                        <td>

                            GMT中cookie的到期日。
                            如果未指定或设置为0，则创建会话cookie。

                        </td>
                    </tr>
                    <tr>
                        <td><code>httpOnly</code></td>
                        <td>Boolean</td>
                        <td>

                            标记cookie只能由Web服务器访问。

                        </td>
                    </tr>
                    <tr>
                        <td><code>maxAge</code></td>
                        <td>Number</td>
                        <td>

                            方便的选项，用于设置相对于当前时间的到期时间（以毫秒为单位）。

                        </td>
                    </tr>
                    <tr>
                        <td><code>path</code></td>
                        <td>String</td>
                        <td>

                            Cookie的路径。
                            默认为“/”。

                        </td>
                    </tr>
                    <tr>
                        <td><code>secure</code></td>
                        <td>Boolean</td>
                        <td>

                            将cookie标记为仅与HTTPS一起使用。

                        </td>
                    </tr>
                    <tr>
                        <td><code>signed</code></td>
                        <td>Boolean</td>
                        <td>

                            指示cookie是否应该签名。

                        </td>
                    </tr>
                    <tr>
                        <td><code>sameSite</code></td>
                        <td>Boolean 或 String</td>
                        <td>“SameSite”<strong>Set-Cookie</strong>

                            属性的值。
                            更多信息，
                            <a href="https://tools.ietf.org/html/draft-ietf-httpbis-cookie-same-site-00#section-4.1.1">请访问
                                https://tools.ietf.org/html/draft-ietf-httpbis-cookie-same-site-00#section-4.1.1</a>。</td>
                    </tr>
                </tbody>
            </table>

            <div class="doc-box doc-notice">
                <p>

                    所有
                    <code>res.cookie()</code>

                    操作都是
                    <code>Set-Cookie</code>

                    使用提供的选项设置
                    HTTP
                    标头。
                    未指定的任何选项默认为
                    <a href="http://tools.ietf.org/html/rfc6265">

                        RFC 6265中

                    </a>

                    规定的值
                    。

                </p>
            </div>

            <p>

                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'tobi'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> domain<span class="token punctuation">:</span> <span class="token string">'.example.com'</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token string">'/admin'</span><span class="token punctuation">,</span> secure<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'rememberme'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">900000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> httpOnly<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                该
                <code>encode</code>

                选项允许您选择用于cookie值编码的函数。
                不支持异步函数。

            </p>

            <p>

                示例用例：您需要为组织中的其他站点设置域范围的cookie。
                此其他站点（不受您的管理控制）不使用URI编码的cookie值。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">//Default encoding
      </span>res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'some_cross_domain_cookie'</span><span class="token punctuation">,</span> <span class="token string">'http://mysubdomain.example.com'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>domain<span class="token punctuation">:</span><span class="token string">'example.com'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Result: 'some_cross_domain_cookie=http%3A%2F%2Fmysubdomain.example.com; Domain=example.com; Path=/'
      </span>
      <span class="token comment" spellcheck="true">//Custom encoding
      </span>res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'some_cross_domain_cookie'</span><span class="token punctuation">,</span> <span class="token string">'http://mysubdomain.example.com'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>domain<span class="token punctuation">:</span><span class="token string">'example.com'</span><span class="token punctuation">,</span> encode<span class="token punctuation">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Result: 'some_cross_domain_cookie=http://mysubdomain.example.com; Domain=example.com; Path=/;'
      </span></code></pre>

            <p>

                该
                <code>maxAge</code>

                选项是一个便利选项，用于设置相对于当前时间的“过期”（以毫秒为单位）。
                以下等同于上面的第二个例子。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'rememberme'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token punctuation">:</span> <span class="token number">900000</span><span class="token punctuation">,</span> httpOnly<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                您可以传递一个对象作为
                <code>value</code>

                参数;
                然后将其序列化为JSON并由
                <code>bodyParser()</code>

                中间件
                解析
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token punctuation">:</span> <span class="token number">900000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                使用
                <a href="https://www.npmjs.com/package/cookie-parser">

                    cookie-parser

                </a>

                中间件时，此方法还支持签名cookie。
                只需将
                <code>signed</code>

                选项设置为
                <code>true</code>

                。
                然后
                <code>res.cookie()</code>

                将使用传递给的秘密
                <code>cookieParser(secret)</code>

                来签署该值。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'tobi'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signed<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                稍后您可以通过
                <a href="#req.signedCookies" class="active">

                    req.signedCookie

                </a>

                对象
                访问此值
                。

            </p>

        </section>

        <section>
            <h3 id="res.clearCookie">

                res.clearCookie（name [，options]）

            </h3>

            <p>

                清除指定的cookie
                <code>name</code>

                。
                有关该
                <code>options</code>

                对象的
                详细信息
                ，请参阅
                <a href="#res.cookie" class="active">

                    res.cookie（）

                </a>

                。

            </p>

            <div class="doc-box doc-notice">
                <p>

                    Web浏览器和其他兼容客户端只有在给
                    <code>options</code>

                    定与
                    <a href="#res.cookie" class="active">

                        res.cookie（）

                    </a>

                    相同的
                    情况下才会清除cookie

                    ，不包括

                    <code>expires</code>

                    和
                    <code>maxAge</code>

                    。

                </p>
            </div>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">cookie<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'tobi'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/admin'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">clearCookie<span class="token punctuation">(</span></span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/admin'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.download">

                res.download（path [，filename] [，options] [，fn]）

            </h3>

            <div class="doc-box doc-info">
                <p>
                    <code>options</code>

                    Express v4.16.0及更高版本支持
                    可选
                    参数。

                </p>
            </div>

            <p>

                将文件
                <code>path</code>

                作为“附件”
                传输
                。
                通常，浏览器会提示用户下载。
                默认情况下，
                <code>Content-Disposition</code>

                标题“filename =”参数是
                <code>path</code>

                （这通常出现在浏览器对话框中）。
                使用
                <code>filename</code>

                参数
                覆盖此默认值
                。

            </p>

            <p>

                发生错误或传输完成时，该方法将调用可选的回调函数
                <code>fn</code>

                。
                此方法使用
                <a href="#res.sendFile" class="active">

                    res.sendFile（）

                </a>

                来传输文件。

            </p>

            <p>

                可选
                <code>options</code>

                参数传递给基础
                <a href="#res.sendFile" class="active">

                    res.sendFile（）

                </a>


                调用，并采用完全相同的参数。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">download<span class="token punctuation">(</span></span><span class="token string">'/report-12345.pdf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      res<span class="token punctuation">.</span><span class="token function">download<span class="token punctuation">(</span></span><span class="token string">'/report-12345.pdf'</span><span class="token punctuation">,</span> <span class="token string">'report.pdf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      res<span class="token punctuation">.</span><span class="token function">download<span class="token punctuation">(</span></span><span class="token string">'/report-12345.pdf'</span><span class="token punctuation">,</span> <span class="token string">'report.pdf'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// Handle error, but keep in mind the response may be partially-sent
      </span>    <span class="token comment" spellcheck="true">// so check res.headersSent
      </span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// decrement a download credit, etc.
      </span>  <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.end">

                res.end（[data] [，encoding]）

            </h3>

            <p>

                结束响应过程。
                这个方法实际上来自Node核心，特别
                <a href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback">

                    是http.ServerResponse

                </a>

                的<a href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback">
                    response.end（）方法
                </a>
                。

            </p>

            <p>

                用于在没有任何数据的情况下快速结束响应。
                如果需要响应数据，请使用
                <a href="#res.send" class="active">

                    res.send（）

                </a>

                和
                <a href="#res.json" class="active">

                    res.json（）等方法

                </a>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">end<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.format">

                res.format（对象）

            </h3>

            <p>
                <code>Accept</code>

                对请求对象
                上的
                HTTP标头
                执行内容协商
                （如果存在）。
                它使用
                <a href="#req.accepts" class="active">

                    req.accepts（）

                </a>

                根据质量值排序的可接受类型为请求选择处理程序。
                如果未指定标头，则调用第一个回调。
                如果未找到匹配项，则服务器将以406“Not Acceptable”响应，或调用
                <code>default</code>

                回调。

            </p>

            <p>

                在
                <code>Content-Type</code>

                当选择一个回调响应首部设置。
                但是，您可以使用诸如
                <code>res.set()</code>

                或
                之类的方法在回调中更改此值
                <code>res.type()</code>

                。

            </p>

            <p>
                <code>{ "message": "hey" }</code>

                当
                <code>Accept</code>

                header字段设置为“application / json”或“* / json”
                时，
                以下示例将响应
                （但如果它是“* / *”，则响应将为“hey”）。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">format<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
        <span class="token string">'text/plain'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'hey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      
        <span class="token string">'text/html'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'&lt;p&gt;hey&lt;/p&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      
        <span class="token string">'application/json'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">'hey'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      
        <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// log the request and respond with 406
      </span>    res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">406</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Not Acceptable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                除了规范化的MIME类型之外，您还可以使用映射到这些类型的扩展名来实现稍微冗长的实现：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">format<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
        text<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'hey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      
        html<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'&lt;p&gt;hey&lt;/p&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      
        json<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">'hey'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.get">

                res.get（场）

            </h3>

            <p>

                返回由指定的HTTP响应头
                <code>field</code>

                。
                该匹配不区分大小写。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; "text/plain"
      </span></code></pre>

        </section>

        <section>
            <h3 id="res.json">

                res.json（[机构]）

            </h3>

            <p>

                发送JSON响应。
                此方法使用
                <a
                    href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">

                    JSON.stringify（）

                </a>

                发送响应（具有正确的内容类型），该响应是转换为JSON字符串的参数
                。

            </p>

            <p>

                参数可以是任何JSON类型，包括对象，数组，字符串，布尔值或数字，您也可以使用它将其他值转换为JSON，例如
                <code>null</code>

                和
                <code>undefined</code>


                （尽管这些在技术上是无效的JSON）。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">'tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">'message'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.jsonp">

                res.jsonp（[机构]）

            </h3>

            <p>

                使用JSONP支持发送JSON响应。
                <code>res.json()</code>

                除了选择JSONP回调支持外，
                此方法与此方法相同
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">jsonp<span class="token punctuation">(</span></span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; callback(null)
      </span>
      res<span class="token punctuation">.</span><span class="token function">jsonp<span class="token punctuation">(</span></span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">'tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; callback({ "user": "tobi" })
      </span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jsonp<span class="token punctuation">(</span></span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">'message'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; callback({ "error": "message" })
      </span></code></pre>

            <p>

                默认情况下，JSONP回调名称很简单
                <code>callback</code>

                。
                使用
                <a href="#app.settings.table">

                    jsonp回调名称

                </a>

                设置
                覆盖它

                。

            </p>

            <p>

                以下是使用相同代码的JSONP响应的一些示例：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// ?callback=foo
      </span>res<span class="token punctuation">.</span><span class="token function">jsonp<span class="token punctuation">(</span></span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">'tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; foo({ "user": "tobi" })
      </span>
      app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'jsonp callback name'</span><span class="token punctuation">,</span> <span class="token string">'cb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// ?cb=foo
      </span>res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jsonp<span class="token punctuation">(</span></span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">'message'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// =&gt; foo({ "error": "message" })
      </span></code></pre>

        </section>

        <section>
            <h3 id="res.links">

                res.links（链接）

            </h3>

            <p>

                将
                <code>links</code>

                提供的as作为参数的属性
                加入，
                以填充响应的

                <code>Link</code>

                HTTP头字段。

            </p>

            <p>

                例如，以下调用：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">links<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
        next<span class="token punctuation">:</span> <span class="token string">'http://api.example.com/users?page=2'</span><span class="token punctuation">,</span>
        last<span class="token punctuation">:</span> <span class="token string">'http://api.example.com/users?page=5'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                得到以下结果：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">Link<span class="token punctuation">:</span> <span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>users<span class="token operator">?</span>page<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> rel<span class="token operator">=</span><span class="token string">"next"</span><span class="token punctuation">,</span>
            <span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>users<span class="token operator">?</span>page<span class="token operator">=</span><span class="token number">5</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> rel<span class="token operator">=</span><span class="token string">"last"</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.location">

                res.location（路径）

            </h3>

            <p>

                将响应
                <code>Location</code>

                HTTP标头设置为指定的
                <code>path</code>

                参数。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">location<span class="token punctuation">(</span></span><span class="token string">'/foo/bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">location<span class="token punctuation">(</span></span><span class="token string">'http://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">location<span class="token punctuation">(</span></span><span class="token string">'back'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                阿
                <code>path</code>

                “背”的值具有特殊的含义，它指的是在指定的URL
                <code>Referer</code>

                的请求的报头中。
                如果
                <code>Referer</code>

                未指定标头，则引用“/”。

            </p>

            <div class="doc-box doc-warn">
                <p>

                    对URL进行编码后，如果尚未编码，则Express会将指定的URL传递到
                    <code>Location</code>

                    标头中
                    的浏览器
                    ，而不进行任何验证。

                </p>

                <p>

                    浏览器负责从当前URL或引用URL以及
                    <code>Location</code>

                    标题中
                    指定的URL派生预期的URL
                    ;
                    并相应地重定向用户。

                </p>
            </div>

        </section>

        <section>
            <h3 id="res.redirect">

                res.redirect（[status，] path）

            </h3>

            <p>

                重定向到从指定的URL派生的URL
                <code>path</code>

                ，具有指定的
                <code>status</code>

                与
                <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">

                    HTTP状态代码

                </a>

                对应的正整数
                。
                如果未指定，则
                <code>status</code>

                默认为“302”找到“。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'/foo/bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'http://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token string">'http://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'../login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
            <p>

                重定向可以是用于重定向到其他站点的完全限定URL：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'http://google.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
            <p>

                重定向可以相对于主机名的根目录。
                例如，如果应用程序已启用
                <code>http://example.com/admin/post/new</code>

                ，则以下内容将重定向到URL
                <code>http://example.com/admin</code>

                ：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'/admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                重定向可以相对于当前URL。
                例如，从
                <code>http://example.com/blog/admin/</code>

                （注意尾部斜杠），以下将重定向到URL
                <code>http://example.com/blog/admin/post/new</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'post/new'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                重定向到
                <code>post/new</code>

                的
                <code>http://example.com/blog/admin</code>

                （没有尾随斜线），会重定向到
                <code>http://example.com/blog/post/new</code>

                。

            </p>

            <p>

                如果您发现上述行为令人困惑，请将路径段视为目录（带有斜杠）和文件，它将开始有意义。

            </p>

            <p>

                路径相对重定向也是可能的。
                如果您在

                <code>http://example.com/admin/post/new</code>

                ，以下将重定向到

                <code>http://example.com/admin/post</code>

                ：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                一个
                <code>back</code>

                重定向请求重定向回
                <a href="http://en.wikipedia.org/wiki/HTTP_referer">

                    引荐

                </a>

                ，默认为
                <code>/</code>

                引荐丢失时。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'back'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.render">

                res.render（view [，locals] [，callback]）

            </h3>

            <p>

                呈现a
                <code>view</code>

                并将呈现的HTML字符串发送到客户端。
                可选参数：

            </p>

            <ul>
                <li><code>locals</code>

                    ，一个对象，其属性定义视图的局部变量。

                </li>
                <li><code>callback</code>

                    ，一个回调函数。
                    如果提供，则该方法返回可能的错误和呈现的字符串，但不执行自动响应。
                    发生错误时，该方法在
                    <code>next(err)</code>

                    内部
                    调用
                    。

                </li>
            </ul>

            <p>

                该
                <code>view</code>

                参数是一个字符串，它是视图文件来渲染的文件路径。
                这可以是绝对路径，也可以是相对于
                <code>views</code>

                设置
                的路径
                。
                如果路径不包含文件扩展名，则该
                <code>view engine</code>

                设置将确定文件扩展名。
                如果路径确实包含文件扩展名，则Express将为指定的模板引擎（via
                <code>require()</code>

                ）加载模块，并使用加载的模块
                <code>__express</code>

                函数
                对其进行渲染
                。

            </p>

            <p>

                有关更多信息，请参阅
                <a href="/guide/using-template-engines.html">

                    使用Express的模板引擎

                </a>

                。

            </p>

            <p><strong>

                    注：

                </strong>

                该
                <code>view</code>

                参数执行文件系统操作，比如从磁盘读取文件和评估的Node.js模块，并且因此出于安全考虑，不应该包含从最终用户的输入。


            </p>

            <div class="doc-box doc-notice">
                <p>

                    局部变量
                    <code>cache</code>

                    启用视图缓存。
                    将其设置为
                    <code>true</code>

                    ，以在开发期间缓存视图;
                    默认情况下，生产中启用了视图缓存。

                </p>
            </div>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// send the rendered view to the client
      </span>res<span class="token punctuation">.</span><span class="token function">render<span class="token punctuation">(</span></span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// if a callback is specified, the rendered HTML string has to be sent explicitly
      </span>res<span class="token punctuation">.</span><span class="token function">render<span class="token punctuation">(</span></span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// pass a local variable to the view
      </span>res<span class="token punctuation">.</span><span class="token function">render<span class="token punctuation">(</span></span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.send">

                res.send（[机构]）

            </h3>

            <p>

                发送HTTP响应。

            </p>

            <p>

                所述
                <code>body</code>

                参数可以是一个
                <code>Buffer</code>

                对象，一个
                <code>String</code>

                ，对象，或一个
                <code>Array</code>

                。
                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'whoop'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token punctuation">{</span> some<span class="token punctuation">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'&lt;p&gt;some html&lt;/p&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Sorry, we cannot find that!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">'something blew up'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                此方法为简单的非流式响应执行许多有用的任务：例如，它自动分配
                <code>Content-Length</code>

                HTTP响应头字段（除非先前已定义）并提供自动HEAD和HTTP缓存新鲜度支持。

            </p>

            <p>

                当参数是
                <code>Buffer</code>

                对象时，该方法将
                <code>Content-Type</code>


                响应头字段设置为“application / octet-stream”，除非先前定义如下所示：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'&lt;p&gt;some html&lt;/p&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                当参数为a时
                <code>String</code>

                ，该方法将设置
                <code>Content-Type</code>

                为“text / html”：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'&lt;p&gt;some html&lt;/p&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                当参数是
                <code>Array</code>

                或时
                <code>Object</code>

                ，Express以JSON表示响应：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">'tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.sendFile">

                res.sendFile（path [，options] [，fn]）

            </h3>

            <div class="doc-box doc-info">
                <p><code>res.sendFile()</code>

                    Express v4.8.0以后版本支持。

                </p>
            </div>

            <p>

                在给定的时间传输文件
                <code>path</code>

                。
                <code>Content-Type</code>

                根据文件名的扩展名
                设置
                响应HTTP标头字段。
                除非
                <code>root</code>

                在options对象中设置了该选项，
                <code>path</code>

                否则必须是该文件的绝对路径。

            </p>

            <p>

                下表提供了有关
                <code>options</code>

                参数的
                详细信息
                。

            </p>

            <div class="table-scroller">

                <table>
                    <thead>
                        <tr>
                            <th>

                                属性

                            </th>
                            <th>

                                描述

                            </th>
                            <th>

                                默认

                            </th>
                            <th>

                                可用性

                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>maxAge</code></td>
                            <td>
                                <code>Cache-Control</code>

                                以毫秒为单位
                                设置
                                标头
                                的max-age属性
                                或以<a href="https://www.npmjs.org/package/ms">
                                    ms格式
                                </a>
                                设置字符串
                                <a href="https://www.npmjs.org/package/ms">

                                </a>
                            </td>
                            <td>

                                0

                            </td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td><code>root</code></td>
                            <td>

                                相对文件名的根目录。

                            </td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td><code>lastModified</code></td>
                            <td>

                                将
                                <code>Last-Modified</code>

                                标头
                                设置
                                为OS上文件的上次修改日期。
                                设置
                                <code>false</code>

                                为禁用它。

                            </td>
                            <td>

                                启用

                            </td>
                            <td>

                                4.9.0+

                            </td>
                        </tr>
                        <tr>
                            <td><code>headers</code></td>
                            <td>

                                包含要与文件一起提供的HTTP标头的对象。

                            </td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td><code>dotfiles</code></td>
                            <td>

                                服务dotfiles的选项。
                                可能的值是“允许”，“拒绝”，“忽略”。

                            </td>
                            <td>

                                “忽视”

                            </td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td><code>acceptRanges</code></td>
                            <td>

                                启用或禁用接受范围请求。

                            </td>
                            <td><code>true</code></td>
                            <td>

                                4.14+

                            </td>
                        </tr>
                        <tr>
                            <td><code>cacheControl</code></td>
                            <td>

                                启用或禁用设置
                                <code>Cache-Control</code>

                                响应标头。

                            </td>
                            <td><code>true</code></td>
                            <td>

                                4.14+

                            </td>
                        </tr>
                        <tr>
                            <td><code>immutable</code></td>
                            <td>
                                <code>immutable</code>

                                在
                                <code>Cache-Control</code>

                                响应头中
                                启用或禁用该
                                指令
                                。
                                如果启用，
                                <code>maxAge</code>

                                还应指定
                                该
                                选项以启用缓存。
                                该
                                <code>immutable</code>

                                指令将阻止受支持的客户端在
                                <code>maxAge</code>

                                选项
                                的生命周期内发出条件请求，
                                以检查文件是否已更改。

                            </td>
                            <td><code>false</code></td>
                            <td>

                                4.16+

                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>

            <p>
                <code>fn(err)</code>

                传输完成或发生错误时，
                该方法调用回调函数
                。
                如果指定了回调函数并且发生错误，则回调函数必须通过结束请求 - 响应周期或将控制传递给下一个路径来显式处理响应过程。


            </p>

            <p>

                以下是使用
                <code>res.sendFile</code>

                其所有参数
                的示例
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/file/:name'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
        <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
          root<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/public/'</span><span class="token punctuation">,</span>
          dotfiles<span class="token punctuation">:</span> <span class="token string">'deny'</span><span class="token punctuation">,</span>
          headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">'x-timestamp'</span><span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token string">'x-sent'</span><span class="token punctuation">:</span> <span class="token keyword">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      
        <span class="token keyword">var</span> fileName <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">sendFile<span class="token punctuation">(</span></span>fileName<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'Sent:'</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                以下示例说明了使用

                <code>res.sendFile</code>

                为提供文件提供细粒度支持：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:uid/photos/:file'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>uid
          <span class="token punctuation">,</span> file <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
      
        req<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">mayViewFilesFrom<span class="token punctuation">(</span></span>uid<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>yes<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>yes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">sendFile<span class="token punctuation">(</span></span><span class="token string">'/uploads/'</span> <span class="token operator">+</span> uid <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">"Sorry! You can't see that."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>
            <p>

                有关更多信息，或者如果您有任何问题或疑虑，请参阅
                <a href="https://github.com/pillarjs/send">

                    发送

                </a>

                。

            </p>

        </section>

        <section>
            <h3 id="res.sendStatus">

                res.sendStatus（的StatusCode）

            </h3>

            <p>

                将响应HTTP状态代码设置为
                <code>statusCode</code>

                并将其字符串表示形式发送为响应正文。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// equivalent to res.status(200).send('OK')
      </span>res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// equivalent to res.status(403).send('Forbidden')
      </span>res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// equivalent to res.status(404).send('Not Found')
      </span>res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// equivalent to res.status(500).send('Internal Server Error')
      </span></code></pre>

            <p>

                如果指定了不受支持的状态代码，则HTTP状态仍设置为，
                <code>statusCode</code>

                并且代码的字符串版本将作为响应正文发送。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// equivalent to res.status(2000).send('2000')
      </span></code></pre>

            <p><a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">

                    有关HTTP状态代码的更多信息

                </a></p>

        </section>

        <section>
            <h3 id="res.set">

                res.set（field [，value]）

            </h3>

            <p>

                将响应的HTTP标头设置
                <code>field</code>

                为
                <code>value</code>

                。
                要一次设置多个字段，请传递一个对象作为参数。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>
        <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
      
        <span class="token string">'ETag'</span><span class="token punctuation">:</span> <span class="token string">'12345'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                别名为
                <code>res.header(field [, value])</code>

                。

            </p>

        </section>

        <section>
            <h3 id="res.status">

                res.status（代码）

            </h3>

            <p>

                设置响应的HTTP状态。
                它是Node的
                <a href="http://nodejs.org/api/http.html#http_response_statuscode">

                    response.statusCode

                </a>

                的可链接别名
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Bad Request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status<span class="token punctuation">(</span></span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile<span class="token punctuation">(</span></span><span class="token string">'/absolute/path/to/404.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="res.type">

                res.type（类型）

            </h3>

            <p>

                将
                <code>Content-Type</code>

                HTTP标头
                设置
                为由
                <a href="https://github.com/broofa/node-mime#mimelookuppath">

                    mime.lookup（）

                </a>

                为指定
                的MIME类型确定的MIME类型

                <code>type</code>

                。
                如果
                <code>type</code>

                包含“/”字符，则将其设置
                <code>Content-Type</code>

                为
                <code>type</code>

                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">type<span class="token punctuation">(</span></span><span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// =&gt; 'text/html'
      </span>res<span class="token punctuation">.</span><span class="token function">type<span class="token punctuation">(</span></span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// =&gt; 'text/html'
      </span>res<span class="token punctuation">.</span><span class="token function">type<span class="token punctuation">(</span></span><span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// =&gt; 'application/json'
      </span>res<span class="token punctuation">.</span><span class="token function">type<span class="token punctuation">(</span></span><span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// =&gt; 'application/json'
      </span>res<span class="token punctuation">.</span><span class="token function">type<span class="token punctuation">(</span></span><span class="token string">'png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// =&gt; image/png:
      </span></code></pre>

        </section>

        <section>
            <h3 id="res.vary">

                res.vary（场）

            </h3>

            <p>

                将字段添加到
                <code>Vary</code>

                响应标头（如果尚未存在）。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">res<span class="token punctuation">.</span><span class="token function">vary<span class="token punctuation">(</span></span><span class="token string">'User-Agent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render<span class="token punctuation">(</span></span><span class="token string">'docs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <h2 id="router">

            路由器

        </h2>

        <section>
            <p>

                一个
                <code>router</code>

                对象是中间件和路由的独立实例。
                您可以将其视为“迷你应用程序”，只能执行中间件和路由函数。
                每个Express应用程序都有一个内置的应用程序路由器。

            </p>

            <p>

                路由器的行为类似于中间件本身，因此您可以将其用作

                <a href="#app.use" class="active">

                    app.use（）

                </a>

                的参数或作为另一个路由器的
                <a href="#router.use" class="active">

                    use（）

                </a>

                方法的参数。

            </p>

            <p>

                顶级
                <code>express</code>

                对象具有一个
                用于创建新
                对象
                的
                <a href="#express.router" class="active">

                    Router（）

                </a>

                方法
                <code>router</code>

                。

            </p>

            <p>

                一旦你创建了一个路由器的对象，你可以添加中间件和HTTP方法路由（如
                <code>get</code>

                ，
                <code>put</code>

                ，
                <code>post</code>

                ，等），以它就像一个应用程序。
                例如：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// invoked for any requests passed to this router
      </span>router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// .. some logic here .. like any other middleware
      </span>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// will handle any request that ends in /events
      </span><span class="token comment" spellcheck="true">// depends on where the router is "use()'d"
      </span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/events'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ..
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                然后，您可以使用路由器来处理特定的根URL，从而将路由分成文件甚至是迷你应用程序。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// only requests to /calendar/* will be sent to our "router"
      </span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/calendar'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <h3 id="router.methods">

            方法

        </h3>

        <section>
            <h3 id="router.all">

                router.all（path，[callback，...] callback）

            </h3>

            <p>

                此方法与
                <code>router.METHOD()</code>

                方法
                类似
                ，只是它匹配所有HTTP方法（动词）。

            </p>

            <p>

                此方法对于映射特定路径前缀或任意匹配的“全局”逻辑非常有用。
                例如，如果将以下路由放在所有其他路由定义的顶部，则需要从该点开始的所有路由都需要身份验证，并自动加载用户。
                请记住，这些回调不必充当终点;
                <code>loadUser</code>


                可以执行任务，然后调用
                <code>next()</code>

                以继续匹配后续路由。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'*'</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                或等效的：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'*'</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span>
      router<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'*'</span><span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                另一个例子是白名单的“全局”函数。
                这里的示例与之前非常相似，但它仅限制前缀为“/ api”的路径：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token string">'/api/*'</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="router.METHOD">

                router.METHOD（path，[callback，...] callback）

            </h3>

            <p>

                这些
                <code>router.METHOD()</code>

                方法在Express中提供路由函数，其中METHOD是HTTP方法之一，例如GET，PUT，POST等，小写。

                因此，实际的方法是
                <code>router.get()</code>

                ，
                <code>router.post()</code>

                ，

                <code>router.put()</code>

                ，等等。

            </p>

            <div class="doc-box doc-info">
                <p>

                    除了
                    之前未为路径调用
                    的
                    方法
                    之外，还会
                    <code>router.get()</code>

                    自动为HTTP
                    <code>HEAD</code>

                    方法
                    调用
                    该
                    函数
                    。
                    <code>GET</code>
                    <code>router.head()</code>
                    <code>router.get()</code>

                </p>
            </div>

            <p>

                您可以提供多个回调，并且所有回调都是平等对待的，并且行为就像中间件一样，除了这些回调可能会调用
                <code>next('route')</code>


                以绕过剩余的路由回调。
                您可以使用此机制在路由上执行前置条件，然后在没有理由继续匹配的路由时将控制权传递给后续路由。

            </p>

            <p>

                以下代码段说明了可能的最简单的路由定义。
                Express将路径字符串转换为正则表达式，在内部用于匹配传入的请求。
                执行这些匹配时
                <em>

                    不

                </em>

                考虑
                查询字符串
                ，例如“GET /”将匹配以下路由，“GET /？name = tobi”也是如此。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>
                您还可以使用正则表达式 - 如果您有非常具体的约束，则有用，例如，以下内容将匹配“GET / commits /
                71dbb9c”以及“GET /commits/71dbb9c..4c084f9”。
            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/commits\/(\w+)(?:\.\.(\w+))?$/</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> from <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> to <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'HEAD'</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'commit range '</span> <span class="token operator">+</span> from <span class="token operator">+</span> <span class="token string">'..'</span> <span class="token operator">+</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="router.param">

                router.param（名称，回调）

            </h3>

            <p>

                添加回调触发器以路由参数，其中
                <code>name</code>

                是
                参数
                的名称，并且
                <code>callback</code>

                是回调函数。
                虽然
                <code>name</code>

                从技术上讲是可选的，但从Express v4.11.0开始不推荐使用不带它的方法（见下文）。

            </p>

            <p>

                回调函数的参数是：

            </p>

            <ul>
                <li><code>req</code>

                    ，请求对象。

                </li>
                <li><code>res</code>

                    ，响应对象。

                </li>
                <li><code>next</code>

                    ，表明下一个中间件函数。

                </li>
                <li>
                    <code>name</code>

                    参数
                    的值
                    。

                </li>
                <li>

                    参数的名称。

                </li>
            </ul>

            <div class="doc-box doc-info">
                <p>

                    与之不同
                    <code>app.param()</code>

                    ，
                    <code>router.param()</code>

                    不接受一系列路由参数。

                </p>
            </div>

            <p>

                例如，当
                <code>:user</code>

                路径路径中存在
                时
                ，您可以映射用户加载逻辑以自动提供
                <code>req.user</code>

                给路径，或者对参数输入执行验证。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
        <span class="token comment" spellcheck="true">// try to get the user details from the User model and attach it to the request object
      </span>  User<span class="token punctuation">.</span><span class="token function">find<span class="token punctuation">(</span></span>id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            req<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'failed to load user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                Param回调函数是定义它们的路由器的本地函数。
                它们不是由已安装的应用程序或路由器继承的。
                因此，定义的参数回调
                <code>router</code>

                只能由路由上定义的路由参数触发
                <code>router</code>

                。

            </p>

            <p>

                即使参数在多个路由中匹配，参数回调也只会在请求 - 响应周期中调用一次，如以下示例所示。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'CALLED ONLY ONCE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'although this matches'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'and this matches too'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在
                <code>GET /user/42</code>

                ，打印以下内容：

            </p>

            <pre class="language-sh"><code class="language-sh">CALLED ONLY ONCE
      although this matches
      and this matches too
      </code></pre>

            <div class="doc-box doc-warn">
                <p>

                    以下部分介绍
                    <code>router.param(callback)</code>

                    了自v4.11.0起不推荐使用的内容。

                </p>
            </div>

            <p>
                <code>router.param(name, callback)</code>

                通过仅传递函数可以完全改变方法
                的行为
                <code>router.param()</code>

                。
                这个函数是
                <code>router.param(name, callback)</code>

                应该
                如何
                表现
                的自定义实现
                - 它接受两个参数并且必须返回一个中间件。

            </p>

            <p>

                此函数的第一个参数是应捕获的URL参数的名称，第二个参数可以是可用于返回中间件实现的任何JavaScript对象。


            </p>

            <p>

                函数返回的中间件决定捕获URL参数时发生的行为。

            </p>

            <p>

                在此示例中，
                <code>router.param(name, callback)</code>

                签名被修改为
                <code>router.param(name, accessId)</code>

                。
                <code>router.param()</code>

                现在接受姓名和号码
                ，而不是接受姓名和回调
                。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// customizing the behavior of router.param()
      </span>router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// using the customized router.param()
      </span>router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// route to trigger the capture
      </span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'Ready'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                在此示例中，
                <code>router.param(name, callback)</code>

                签名保持不变，但是代替中间件回调，已定义自定义数据类型检查函数以验证用户ID的数据类型。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validator<span class="token punctuation">(</span></span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">sendStatus<span class="token punctuation">(</span></span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isNaN<span class="token punctuation">(</span></span><span class="token function">parseFloat<span class="token punctuation">(</span></span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFinite<span class="token punctuation">(</span></span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

        </section>

        <section>
            <h3 id="router.route">

                router.route（路径）

            </h3>

            <p>

                返回单个路由的实例，然后可以使用该实例处理带有可选中间件的HTTP谓词。
                使用
                <code>router.route()</code>

                以避免重复路线的命名，因此输入错误。

            </p>

            <p>

                基于上面的
                <code>router.param()</code>

                示例，以下代码显示了如何使用它

                <code>router.route()</code>

                来指定各种HTTP方法处理程序。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      router<span class="token punctuation">.</span><span class="token function">param<span class="token punctuation">(</span></span><span class="token string">'user_id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// sample user, would actually fetch from DB, etc...
      </span>  req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
          id<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
          name<span class="token punctuation">:</span> <span class="token string">'TJ'</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      router<span class="token punctuation">.</span><span class="token function">route<span class="token punctuation">(</span></span><span class="token string">'/users/:user_id'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">all<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// runs for all HTTP verbs first
      </span>  <span class="token comment" spellcheck="true">// think of it as route specific middleware!
      </span>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">put<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// just an example of maybe updating the user
      </span>  req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// save user ... etc
      </span>  res<span class="token punctuation">.</span><span class="token function">json<span class="token punctuation">(</span></span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'not implemented'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'not implemented'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                此方法重用单个
                <code>/users/:user_id</code>

                路径并为各种HTTP方法添加处理程序。

            </p>

            <div class="doc-box doc-info">
                <p>

                    注意：使用时
                    <code>router.route()</code>

                    ，中间件排序基于
                    创建
                    <em>

                        路径的

                    </em>

                    时间，而不是
                    基于
                    方法处理程序添加到路径时。
                    为此，您可以将方法处理程序视为属于添加它们的路径。

                </p>
            </div>

        </section>

        <section>
            <h3 id="router.use">

                router.use（[path]，[function，...] function）

            </h3>

            <p>

                使用指定的中间件函数或函数，以及可选的安装路径
                <code>path</code>

                ，默认为“/”。

            </p>

            <p>

                此方法类似于
                <a href="#app.use" class="active">

                    app.use（）

                </a>

                。
                下面描述一个简单的例子和​​用例。
                有关
                更多信息，
                请参阅
                <a href="#app.use" class="active">

                    app.use（）

                </a>

                。

            </p>

            <p>

                中间件就像一个管道管道：请求从定义的第一个中间件函数开始，并按照它们匹配的每个路径“中断”中间件堆栈处理。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// simple logger for this router's requests
      </span><span class="token comment" spellcheck="true">// all requests to this router will first hit this middleware
      </span>router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">'%s %s %s'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// this will only be invoked if the path starts with /bar from the mount point
      </span>router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/bar'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ... maybe some additional /bar logging ...
      </span>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment" spellcheck="true">// always invoked
      </span>router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/foo'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      app<span class="token punctuation">.</span><span class="token function">listen<span class="token punctuation">(</span></span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                “mount”路径被剥离，
                中间件函数
                <em>

                    不

                </em>

                可见。
                此函数的主要作用是安装的中间件函数可以在没有代码更改的情况下运行，而不管其“前缀”路径名。

            </p>

            <p>

                您定义中间件的顺序
                <code>router.use()</code>

                非常重要。
                它们按顺序调用，因此顺序定义了中间件优先级。
                例如，通常记录器是您将使用的第一个中间件，因此每个请求都会被记录。

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> logger <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'morgan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token function">logger<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                现在假设您想忽略静态文件的日志记录请求，但是要继续记录之后定义的路由和中间件
                <code>logger()</code>

                。
                <code>express.static()</code>

                在添加记录器中间件之前，
                您只需将呼叫移至
                顶部：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token function">logger<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      router<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send<span class="token punctuation">(</span></span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                另一个例子是提供来自多个目录的文件，优先于“./public”而不是其他目录：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                该
                <code>router.use()</code>

                方法还支持命名参数，以便其他路由器的挂载点可以从使用命名参数的预加载中受益。

            </p>

            <p><strong>

                    注意

                </strong>

                ：虽然这些中间件函数是通过一个特定的路由器加入，
                <em>

                    当

                </em>


                它们运行是由它们所连接到路径（而不是路由器）中所定义。
                因此，如果路由匹配，则通过一个路由器添加的中间件可以运行其他路由器。
                例如，此代码显示安装在同一路径上的两个不同的路由器：

            </p>

            <pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> authRouter <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> openRouter <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      authRouter<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token function">require<span class="token punctuation">(</span></span><span class="token string">'./authenticate'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">basic<span class="token punctuation">(</span></span>usersdb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      authRouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:user_id/edit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment" spellcheck="true">// ... Edit user UI ...  
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      openRouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment" spellcheck="true">// ... List users ... 
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      openRouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:user_id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment" spellcheck="true">// ... View user ... 
      </span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/users'</span><span class="token punctuation">,</span> authRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/users'</span><span class="token punctuation">,</span> openRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      </code></pre>

            <p>

                即使通过
                <code>authRouter</code>

                它
                添加了身份验证中间件，
                它也将在由
                <code>openRouter</code>

                两个路由器安装的路由上运行
                <code>/users</code>

                。
                要避免此行为，请为每个路由器使用不同的路径。

            </p>

        </section>

    </div>
</section>
        </body>

</html>